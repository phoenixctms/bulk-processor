var hasTouchSupport="ontouchstart" in document.documentElement||(/iphone|ipad|ipod|android|blackberry|mini|windowssce|palm/i.test(navigator.userAgent.toLowerCase()));(function(b){b.sketchpad=function(g,f){return new d(g,f)};b.sketchpad.VERSION="0.5.2";var d=function(t,m){var y=this;var z={width:100,height:100,strokes:[],editing:true,regionVisible:false,_regions:[],_inputId:null};jQuery.extend(z,m);var f;if(t.raphael&&t.raphael.constructor==b.constructor){f=t}else{if(typeof t=="string"){f=b(t,z.width,z.height)}else{throw"first argument must be a Raphael object, an element ID, an array with 3 elements"}}var v=f.canvas;var r=$(v).parent();$(r).off();var k=new a();y.regionVisible=function(I){if(I===undefined){return z.regionVisible}z.regionVisible=I;return y};y.regions=function(){return z._regions};y.inputId=function(){return z._inputId};y.paper=function(){return f};y.canvas=function(){return v};y.container=function(){return r};y.pen=function(I){if(I===undefined){return k}k=I;return y};function u(K){var L="";for(var J=0,M=K.length;J<M;J++){var I=K[J];if(I.length==3){L+=I[0]+I[1]+","+I[2]}else{L+=I[0]}}return L}function q(N){var M=[];var L=N.split("L");if(L.length>0){var K=L[0].replace("M","");var I=K.split(",");M.push(["M",parseInt(I[0]),parseInt(I[1])]);for(var J=1,P=L.length;J<P-1;J++){K=L[J];I=K.split(",");M.push(["L",parseInt(I[0]),parseInt(I[1])])}K=L[L.length-1];if(L.length>=2){var O=false;if(K.indexOf("Z")==(K.length-1)){K=K.substring(0,K.length-1);O=true}I=K.split(",");M.push(["L",parseInt(I[0]),parseInt(I[1])]);if(O){M.push(["Z"])}}}return M}y.json=function(K){if(K===undefined){var J=[];for(var I=0,M=n.length;I<M;I++){var L=jQuery.extend(true,{},n[I]);J[I]=L;if(typeof L.path=="object"){L.path=u(L.path)}}return JSON.stringify(J)}return y.strokes(JSON.parse(K))};y.strokes=function(J){if(J===undefined){return n}if(jQuery.isArray(J)){n=J;for(var I=0,L=n.length;I<L;I++){var K=n[I];if(typeof K.path=="string"){K.path=q(K.path)}}j.add({type:"batch",strokes:jQuery.merge([],n)});F();x()}return y};y.freeze_history=function(){j.freeze()};y.undoable=function(){return j.undoable()};y.undo=function(){if(j.undoable()){j.undo();n=j.current_strokes();F();x()}return y};y.redoable=function(){return j.redoable()};y.redo=function(){if(j.redoable()){j.redo();n=j.current_strokes();F();x()}return y};y.clear=function(){j.add({type:"clear"});n=[];F();x();return y};y.animate=function(J){if(J===undefined){J=500}f.clear();if(n.length>0){var K=0;function I(){var M=n[K];var L=M.type;f[L]().attr(M).click(w);K++;if(K<n.length){setTimeout(I,J)}}I()}return y};function D(){return hasTouchSupport}y.editing=function(I){if(I===undefined){return z.editing}z.editing=I;if(z.editing){if(z.editing=="erase"){$(r).css("cursor","crosshair");$(r).unbind("mousedown",g);$(r).unbind("mousemove",o);$(r).unbind("mouseup",l);$(document).unbind("mouseup",l);if(D()){$(r).unbind("touchstart",C);$(r).unbind("touchmove",G);$(r).unbind("touchend",h)}}else{$(r).css("cursor","crosshair");$(r).mousedown(g);$(r).mousemove(o);$(r).mouseup(l);$(document).mouseup(l);if(D()){$(r).bind("touchstart",C);$(r).bind("touchmove",G);$(r).bind("touchend",h)}}}else{$(r).attr("style","cursor:default");$(r).unbind("mousedown",g);$(r).unbind("mousemove",o);$(r).unbind("mouseup",l);$(document).unbind("mouseup",l);if(D()){$(r).unbind("touchstart",C);$(r).unbind("touchmove",G);$(r).unbind("touchend",h)}}return y};var B=function(){};y.change=function(I){if(I==null||I===undefined){B=function(){}}else{if(typeof I=="function"){B=I}}};function x(){B()}var A=function(){return false};y.strokedrawn=function(I){if(I==null||I===undefined){A=function(){return false}}else{if(typeof I=="function"){A=I}}};function s(I){if(!jQuery.isArray(I.path)){I.path=q(I.path)}return A(I)}var H=function(){return false};y.patchstroke=function(I){if(I==null||I===undefined){H=function(){return false}}else{if(typeof I=="function"){H=I}}};function p(I){return H(I)}function F(){f.clear();for(var I=0,L=n.length;I<L;I++){var K=n[I];var J=K.type;f[J]().attr(K).click(w)}}function i(){$("*").css("-webkit-user-select","none");$("*").css("-moz-user-select","none");if(jQuery.browser.msie){$("body").attr("onselectstart","return false;")}}function E(){$("*").css("-webkit-user-select","text");$("*").css("-moz-user-select","text");if(jQuery.browser.msie){$("body").removeAttr("onselectstart")}}function w(L){if(z.editing=="erase"){var K=this.attr();K.type=this.type;if(p(K)){return}j.add({type:"erase",stroke:K});for(var I=0,M=n.length;I<M;I++){var J=n[I];if(equiv(J,K)){n.splice(I,1)}}x();this.remove()}}function g(I){i();k.start(I,y)}function o(I){k.move(I,y)}function l(L){E();var K=k.finish(L,y);if(K!=null){K.click(w);var J=K.attr();J.type=K.type;var I=s(J);n.push(J);j.add({type:"stroke",stroke:J});if(I){F()}x()}}function C(I){I=I.originalEvent;I.preventDefault();if(I.touches.length==1){var J=I.touches[0];g(J)}}function G(I){I=I.originalEvent;I.preventDefault();if(I.touches.length==1){var J=I.touches[0];o(J)}}function h(I){I=I.originalEvent;I.preventDefault();l(I)}var j=new c();var n=z.strokes;if(jQuery.isArray(n)&&n.length>0){j.add({type:"init",strokes:jQuery.merge([],n)});F()}else{n=[];F()}y.editing(z.editing)};var c=function(){var g=this;var h=[];var f=-1;var j=-1;var i=null;g.add=function(k){if(f+1<h.length){h.splice(f+1,h.length-(f+1))}h.push(k);f=h.length-1;i=null};g.freeze=function(k){if(k===undefined){j=f}else{j=k}};g.undoable=function(){return(f>-1&&f>j)};g.undo=function(){if(g.undoable()){f--;i=null}};g.redoable=function(){return f<h.length-1};g.redo=function(){if(g.redoable()){f++;i=null}};g.current_strokes=function(){if(i==null){var k=[];for(var l=0;l<=f;l++){var o=h[l];switch(o.type){case"init":case"json":case"strokes":case"batch":k=[];jQuery.merge(k,o.strokes);break;case"stroke":k.push(o.stroke);break;case"erase":for(var m=0,q=k.length;m<q;m++){var p=k[m];if(equiv(p,o.stroke)){k.splice(m,1)}}break;case"clear":k=[];break}}i=k}return i}};var a=function(){var n=this;var j="#000000";var i=1;var g=5;var m=null;var l=false;var k=null;var h=[];n.color=function(o){if(o===undefined){return j}j=o;return n};n.width=function(o){if(o===undefined){return g}if(o<a.MIN_WIDTH){o=a.MIN_WIDTH}else{if(o>a.MAX_WIDTH){o=a.MAX_WIDTH}}g=o;return n};n.opacity=function(o){if(o===undefined){return i}if(o<0){o=0}else{if(o>1){o=1}}i=o;return n};n.start=function(q,p){l=true;m=$(p.container()).offset();var o=q.pageX-m.left,r=q.pageY-m.top;h.push([o,r]);k=p.paper().path();k.attr({stroke:j,"stroke-opacity":i,"stroke-width":g,"stroke-linecap":"round","stroke-linejoin":"round"})};n.finish=function(q,o){var p=null;if(k!=null){if(h.length<=1){k.remove()}else{p=k}}l=false;k=null;h=[];return p};n.move=function(q,p){if(l==true){var o=q.pageX-m.left,r=q.pageY-m.top;h.push([o,r]);k.attr({path:f()})}};function f(){if(h!=null&&h.length>1){var r=h[0];var q="M"+r[0]+","+r[1];for(var o=1,s=h.length;o<s;o++){r=h[o];q+="L"+r[0]+","+r[1]}return q}else{return""}}};a.MAX_WIDTH=1000;a.MIN_WIDTH=1;function e(g){var h="";for(var f in g){h+=f+"="+g[f]+"\n"}return h}})(window.Raphael);Raphael.fn.display=function(c){for(var a=0,f=c.length;a<f;a++){var d=c[a];var b=d.type;this[b]().attr(d)}};function hoozit(a){if(a.constructor===String){return"string"}else{if(a.constructor===Boolean){return"boolean"}else{if(a.constructor===Number){if(isNaN(a)){return"nan"}else{return"number"}}else{if(typeof a==="undefined"){return"undefined"}else{if(a===null){return"null"}else{if(a instanceof Array){return"array"}else{if(a instanceof Date){return"date"}else{if(a instanceof RegExp){return"regexp"}else{if(typeof a==="object"){return"object"}else{if(a instanceof Function){return"function"}else{return undefined}}}}}}}}}}}function bindCallbacks(c,b,a){var d=hoozit(c);if(d){if(hoozit(b[d])==="function"){return b[d].apply(b,a)}else{return b[d]}}}var equiv=function(){var b;var c=[];var a=function(){function d(e,f){if(e instanceof f.constructor||f instanceof e.constructor){return f==e}else{return f===e}}return{string:d,"boolean":d,number:d,"null":d,"undefined":d,nan:function(e){return isNaN(e)},date:function(e,f){return hoozit(e)==="date"&&f.valueOf()===e.valueOf()},regexp:function(e,f){return hoozit(e)==="regexp"&&f.source===e.source&&f.global===e.global&&f.ignoreCase===e.ignoreCase&&f.multiline===e.multiline},"function":function(){var e=c[c.length-1];return e!==Object&&typeof e!=="undefined"},array:function(f,g){var h;var e;if(!(hoozit(f)==="array")){return false}e=g.length;if(e!==f.length){return false}for(h=0;h<e;h++){if(!b(g[h],f[h])){return false}}return true},object:function(f,g){var j;var e=true;var h=[],k=[];if(g.constructor!==f.constructor){return false}c.push(g.constructor);for(j in g){h.push(j);if(!b(g[j],f[j])){e=false}}c.pop();for(j in f){k.push(j)}return e&&b(h.sort(),k.sort())}}}();b=function(){var d=Array.prototype.slice.apply(arguments);if(d.length<2){return true}return(function(f,e){if(f===e){return true}else{if(f===null||e===null||typeof f==="undefined"||typeof e==="undefined"||hoozit(f)!==hoozit(e)){return false}else{return bindCallbacks(f,a,[e,f])}}})(d[0],d[1])&&arguments.callee.apply(this,d.splice(1,d.length-1))};return b}();