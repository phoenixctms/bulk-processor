var Sketch=Sketch||{};(function(D){var B="strokes-id";var g=0.4;var G=0.2;var v=1;var w="3c55ee";var A="00ff00";var q=2;var f=3;var o=12;var m=6;var l=f;var k=0.8;var s=v;var p=0.6;var n=0.3;var i=0.01;var x=0;function e(H){return"#"+H}function z(I){var H=jQuery(e(I.inputId()));return H.val()}function F(J){var H=[];var I=[];try{H=JSON.parse(J)}catch(K){}if(H.length>0&&typeof H[H.length-1]=="string"){I=H.pop().split(ID_SEPARATOR_STRING)}return{ids:I,ink:J,strokes:H}}function d(I,J){var H=jQuery(e(I.inputId()));H.val(J);C(I,J)}function C(J,K){if(K!=null&&K.length>0){var H=[];var I=F(K);if(J.regionVisible()){jQuery.merge(H,J.regions())}jQuery.merge(H,I.strokes);J.strokes(H)}else{J.clear()}J.freeze_history()}function r(af,L,O,H,I,ac,N,Y,ad){var J=jQuery(e(L));var ao=jQuery(e(O));J.off();ao.off();var W=false;var V=[];for(var al=9;al<arguments.length;al++){var at=[];try{at=JSON.parse(arguments[al])}catch(ar){}if(at){jQuery.merge(V,at)}}var X=Raphael.sketchpad(O,{height:I,width:H,editing:N,_regions:V,regionVisible:W,_inputId:L});var an=X.pen();var K;var au=N;var Z=ad!=null&&ad.length>0;var M=false;C(X,af);if(N){var aa=jQuery(e(O+"_undo"));aa.off();var T=jQuery(e(O+"_redo"));T.off();var ae=jQuery(e(O+"_clear"));ae.off();if(Z){K=A;an.width(q);an.color("#"+A);an.opacity(g);X.change(function(){if(!M){c(X,aa,T,ae,V);J.val(X.json())}});X.strokedrawn(function(aw){aw.path.push(["Z"]);aw.fill=an.color();aw["fill-opacity"]=G;aw[B]=ad;return true});X.patchstroke(function(aw){aw[B]=ad;return false})}else{K=w;an.width(f);an.color("#"+w);an.opacity(v);var U=[];var ag=[];var ak=[];var av=[];var ab={};var aq=jQuery(e(O+"_regionToggler"));aq.off();var S=jQuery(e(O+"_penWidth0"));S.off();var R=jQuery(e(O+"_penWidth1"));R.off();var Q=jQuery(e(O+"_penWidth2"));Q.off();var P=jQuery(e(O+"_penWidth3"));P.off();var aj=jQuery(e(O+"_penOpacity0"));aj.off();var ai=jQuery(e(O+"_penOpacity1"));ai.off();var ah=jQuery(e(O+"_penOpacity2"));ah.off();X.change(function(){if(!M){c(X,aa,T,ae,V);W=b(X,aq,W);X.regionVisible(W);var ax=X.strokes();var aH=[];var aI=[];var az=[];for(var aA=0;aA<ax.length;aA++){var aJ=ax[aA];if(!(B in aJ)){aH.push(aJ)}}if(aH.length<U.length){U=[];ak=[];ag=[];av=[];ab={};if(x>=1){console.log("strokes removed")}}else{if(x>=1){console.log("strokes added")}}h(U,aH.length);h(ak,V.length);if(V.length>0){for(var aA=0;aA<aH.length;aA++){var aJ=aH[aA];var aD=u(aJ);for(var ay=U[aA];ay<aI.length;ay++){if(Raphael.isBBoxIntersect(az[ay],aD)){var aw=y(aI[ay],aJ.path);if(aw.length>0){jQuery.merge(ag,aw);if(x>=1){console.log("intersections stroke "+aA+" and stroke "+ay+": "+aw)}}}}U[aA]=aI.length;aI.push(aJ.path);az.push(aD)}}for(var aA=0;aA<V.length;aA++){var aC=V[aA];var aF=aC[B];if(aF&&!(aF in ab)){var aG=u(aC);for(var ay=ak[aA];ay<ag.length;ay++){if(!(aF in ab)){var aw=ag[ay];var aE=aw[0];var aB=aw[1];if(Raphael.isPointInsideBBox(aG,aE,aB)&&t(aC.path,aE,aB)){av.push(aF);ab[aF]=true;if(x>=1){console.log("intersection x="+aE+" y="+aB+" hits region "+aF)}}else{if(x>=1){console.log("intersection x="+aE+" y="+aB+" not within region "+aF)}}}}ak[aA]=ag.length}}aH.push(av.join(ID_SEPARATOR_STRING));if(x>=1){console.log("selected region: "+av.join(ID_SEPARATOR_STRING));console.log(av.length+" regions")}J.val(JSON.stringify(aH));if(Y!=null&&Y.length>0){(new Function(Y)).call(X)}}});X.patchstroke(function(az){var aw=X.strokes();for(var ax=0;ax<aw.length;ax++){var ay=aw[ax];if(B in ay){if(equiv(ay.path,az.path)){return true}}}return false});aq.mousedown(function(){aq[0].className="sketch-region-toggler-pressed"});aq.mouseup(function(){W=!W;X.regionVisible(W);var aw=[];if(W){jQuery.merge(aw,V)}var ax=X.strokes();for(var ay=0;ay<ax.length;ay++){var az=ax[ay];if(!(B in az)){aw.push(az)}}X.strokes(aw)});W=b(X,aq,W);X.regionVisible(W);S.mousedown(function(){S[0].className="sketch-pen-width-pressed"});S.mouseup(function(){an.width(o);S[0].className="sketch-pen-width-0";R[0].className="sketch-pen-width-1-disabled";Q[0].className="sketch-pen-width-2-disabled";P[0].className="sketch-pen-width-3-disabled"});R.mousedown(function(){R[0].className="sketch-pen-width-pressed"});R.mouseup(function(){an.width(m);S[0].className="sketch-pen-width-0-disabled";R[0].className="sketch-pen-width-1";Q[0].className="sketch-pen-width-2-disabled";P[0].className="sketch-pen-width-3-disabled"});Q.mousedown(function(){Q[0].className="sketch-pen-width-pressed"});Q.mouseup(function(){an.width(l);S[0].className="sketch-pen-width-0-disabled";R[0].className="sketch-pen-width-1-disabled";Q[0].className="sketch-pen-width-2";P[0].className="sketch-pen-width-3-disabled"});P.mousedown(function(){P[0].className="sketch-pen-width-pressed"});P.mouseup(function(){an.width(k);S[0].className="sketch-pen-width-0-disabled";R[0].className="sketch-pen-width-1-disabled";Q[0].className="sketch-pen-width-2-disabled";P[0].className="sketch-pen-width-3"});aj.mousedown(function(){aj[0].className="sketch-pen-opacity-pressed"});aj.mouseup(function(){an.opacity(s);aj[0].className="sketch-pen-opacity-0";ai[0].className="sketch-pen-opacity-1-disabled";ah[0].className="sketch-pen-opacity-2-disabled"});ai.mousedown(function(){ai[0].className="sketch-pen-opacity-pressed"});ai.mouseup(function(){an.opacity(p);aj[0].className="sketch-pen-opacity-0-disabled";ai[0].className="sketch-pen-opacity-1";ah[0].className="sketch-pen-opacity-2-disabled"});ah.mousedown(function(){ah[0].className="sketch-pen-opacity-pressed"});ah.mouseup(function(){an.opacity(n);aj[0].className="sketch-pen-opacity-0-disabled";ai[0].className="sketch-pen-opacity-1-disabled";ah[0].className="sketch-pen-opacity-2"})}var am=jQuery(e(O+"_colorPicker"));am.off();am.colorPicker({pickerDefault:K,addColors:[K],transparency:false,});am.change(function(){an.color(am.val())});var ap=jQuery(e(O+"_drawEraseMode"));ap.off();ap.mousedown(function(){ap[0].className="sketch-draw-mode-pressed"});ap.mouseup(function(){au=!au;if(au){X.editing(true)}else{X.editing("erase")}if(au){ap[0].className="sketch-draw-mode"}else{ap[0].className="sketch-erase-mode"}});aa.mousedown(function(){if(X.undoable()){aa[0].className="sketch-undo-pressed"}});aa.mouseup(function(){if(X.undoable()){X.undo()}});T.mousedown(function(){if(X.redoable()){T[0].className="sketch-redo-pressed"}});T.mouseup(function(){if(X.redoable()){X.redo()}});ae.mousedown(function(){if(X.strokes().length>0){ae[0].className="sketch-clear-pressed"}});ae.mouseup(function(){if(X.strokes().length>0){X.clear()}});c(X,aa,T,ae,V)}ao.css("width",H+"px");ao.css("height",I+"px");if(ac!=null&&ac.length>0){ao.css("background-image","url("+ac+")")}return X}function u(O){if(typeof O.path=="string"){O.path=E(O.path)}var P=O.path;var K=Number.POSITIVE_INFINITY;var I=0;var J=Number.POSITIVE_INFINITY;var H=0;for(var L=0,N=P.length;L<N;L++){var M=P[L];if(M.length==3){K=Math.min(K,M[1]);I=Math.max(I,M[1]);J=Math.min(J,M[2]);H=Math.max(H,M[2])}}return{x:K,y:J,x2:I,y2:H,width:I-K,height:H-J}}function E(M){var L=[];var K=M.split("L");if(K.length>0){var J=K[0].replace("M","");var H=J.split(",");L.push(["M",parseInt(H[0]),parseInt(H[1])]);for(var I=1,O=K.length;I<O-1;I++){J=K[I];H=J.split(",");L.push(["L",parseInt(H[0]),parseInt(H[1])])}J=K[K.length-1];if(K.length>=2){var N=false;if(J.indexOf("Z")==(J.length-1)){J=J.substring(0,J.length-1);N=true}H=J.split(",");L.push(["L",parseInt(H[0]),parseInt(H[1])]);if(N){L.push(["Z"])}}}return L}function t(K,H,L){var I=a(K);var J=[["M",-1,-1],["L",H,L]];return(y(I,J).length%2)==1}function a(J){var I=jQuery.merge([],J);var K=I[0];var H=I[I.length-1];if(H.length!=3){H=I[I.length-2];I.pop()}I.push(["L",K[1],K[2]]);return I}function y(J,I){var N,T,M,S;var H,L,Y,K;var X=[];for(var R=0,O=J.length;R<O;R++){var W=J[R];if(W[0]=="M"){N=W[1];T=W[2]}else{M=W[1];S=W[2];for(var Q=0,U=I.length;Q<U;Q++){var V=I[Q];if(V[0]=="M"){H=V[1];L=V[2]}else{Y=V[1];K=V[2];var P=j(N,M,T,S,H,Y,L,K);if(P.length>0){X.push(P)}H=Y;L=K}}N=M;T=S}}return X}function j(L,J,W,T,O,N,I,H){var M=T-W;var X=L-J;var Q=M*L+X*W;var K=H-I;var V=O-N;var P=K*O+V*I;var U=M*V-K*X;if(U!=0){var S=(V*Q-X*P)/U;var R=(M*P-K*Q)/U;if(Math.min(L,J)-S<=i&&S-Math.max(L,J)<=i&&Math.min(W,T)-R<=i&&R-Math.max(W,T)<=i&&Math.min(O,N)-S<=i&&S-Math.max(O,N)<=i&&Math.min(I,H)-R<=i&&R-Math.max(I,H)<=i){return[S,R]}}return[]}function c(K,I,J,H,L){if(K.redoable()){J[0].className="sketch-redo"}else{J[0].className="sketch-redo-disabled"}if(K.undoable()){I[0].className="sketch-undo"}else{I[0].className="sketch-undo-disabled"}if(K.strokes().length>0){H[0].className="sketch-clear"}else{H[0].className="sketch-clear-disabled"}}function b(J,I,K){var H=K;if(J.strokes().length==0){H=false}if(H){I[0].className="sketch-region-toggler-on"}else{I[0].className="sketch-region-toggler-off"}return H}function h(J,H){for(var I=0;I<H;I++){if(!J[I]){J[I]=0}}}D.initSketch=r;D.setSketchValue=d;D.getSketchValue=z;D.unpackValue=F;if(x>=1){console.log("sketch utilities loaded")}})(window.Sketch);