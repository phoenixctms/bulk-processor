var floatEpsilon=0.000001;function decodeBase64(b){var a=b.replace(/-/g,"+").replace(/_/g,"/");while(a.length%4){a+="="}return jQuery.base64Decode(a)}function _getElement(a){if(a!=null&&a.length>0){var b=jQuery("#"+a);if(typeof b!=="undefined"&&b!=null&&b.length){return b}}return null}function _testFlag(a,b){if(a&&b){if(typeof a[b]==="undefined"||a[b]==false){return false}else{return true}}return false}function _testPropertyExists(b,a){if(b&&a){if(typeof b[a]==="undefined"||b[a]==null){return false}else{return true}}return false}function _testFunction(a){var b={};return a&&b.toString.call(a)=="[object Function]"}function openInventory(){}function openStaff(){}function openCourse(){}function openTrial(){}function openProband(){}function openInputField(){}function openUser(){}function openMassMail(){}function showErrorMessage(a){var b=_getElement(a+"_div");if(b!=null){b.show()}}function hideErrorMessage(a){var b=_getElement(a+"_div");if(b!=null){b.hide()}}function setErrorMessageText(b,a){var c=_getElement(b);if(c!=null){c.html(a)}}function setErrorMessageTexts(e,f){var h=f.length;var g;var b;var j;var c;var a;var d;if(h>0){setErrorMessageText(e,f[0].output);g=_getElement(e+"_div");if(g!=null){b=g.find("ul").first();b.find("li:not(:first)").remove();if(h>1){j=b.find("li").first();a=j.find("span").first();c=a.attr("id");for(d=1;d<h;d++){j=j.clone();a=j.find("span").first();a.html(f[d].output);a.attr("id",c+"_"+d);b.append(j)}}}}else{setErrorMessageText(e,"");g=_getElement(e+"_div");if(g!=null){b=g.find("ul").first();b.find("li:not(:first)").remove()}}}function _getOutputId(a){return INPUT_FIELD_OUTPUT_ID_PREFIX+a.inquiry.id}var INPUT_JSON_DATETIME_PATTERN="yyyy-MM-dd "+INPUT_TIME_PATTERN;var AJAX_OPERATION_SUCCESS="operationSuccess";var AJAX_FIELD_DELTA_ERROR_MESSAGE_ID="fieldDeltaErrorMessageId";var AJAX_INPUT_FIELD_PROBAND_BASE64="inputFieldProbandBase64";var AJAX_INPUT_FIELD_TRIAL_BASE64="inputFieldTrialBase64";var AJAX_INPUT_FIELD_PROBAND_ADDRESSES_BASE64="inputFieldProbandAddressesBase64";var AJAX_INPUT_FIELD_PROBAND_LIST_ENTRY_BASE64="inputFieldProbandListEntryBase64";var AJAX_INPUT_FIELD_VISIT_SCHEDULE_ITEMS_BASE64="inputFieldVisitScheduleItemsBase64";var AJAX_INPUT_FIELD_PROBAND_GROUPS_BASE64="inputFieldProbandGroupsBase64";var AJAX_INPUT_FIELD_ACTIVE_USER_BASE64="activeUserBase64";var AJAX_INPUT_FIELD_LOCALE="inputFieldLocale";var AJAX_INPUT_FIELD_VARIABLE_VALUES_BASE64="inputFieldVariableValuesBase64";var AJAX_INPUT_FIELD_PROBAND_LIST_ENTRY_TAG_VALUES_BASE64="probandListEntryTagValuesBase64";var INPUT_FIELD_OUTPUT_ID_PREFIX="inputfield_output_";var INPUT_FIELD_OUTPUT_ID_INDEX_SEPARATOR="_";var INPUT_FIELD_WIDGET_VAR_PREFIX="inputFieldWidget_";var INPUT_FIELD_WIDGET_VAR_INDEX_SEPARATOR="_";var INPUT_FIELD_DELTA_SUMMARY_MAX=100;var FIELD_CALCULATION_DECODE_BASE64=true;var FIELD_CALCULATION_DEBUG_LEVEL=0;var FieldCalculation=FieldCalculation||{};(function(h){var at={};var o={};var j=null;var z=false;var f=/^function\((([a-zA-Z0-9_]+,?)*)\)/;var b="en";var af={};af.de={errorIndex:"%s - %s (Index %d)%s%s",error:"%s - %s%s%s",required:" erforderlich",mustBeEmpty:" muss leer sein",mustBeUnchecked:" darf nicht angekreuzt sein",mustBeUnselected:" darf nicht gesetzt sein",mustBeUnmarked:" darf nicht markiert sein","true":"angekreuzt","false":"nicht angekreuzt",calculatedIndex:"%s - %s (Index %d) erwartet: %s",calculated:"%s - %s erwartet: %s",enteredIndex:"%s - %s (Index %d) eingegeben: %s",entered:"%s - %s eingegeben: %s",noSelectionLabel:"[kein]","date is empty":"Datum ist leer","wrong date format":"falsches Datumsformat","year required":"Jahr erforderlich","month not regognized":"Monat nicht erkannt","month required":"Monat erforderlich","day required":"Tag erforderlich","invalid date":"ungültiges Datum","time is empty":"Uhrzeit ist leer","wrong time format":"falsches Uhrzeitformat","hour required":"Stunde erforderlich","minute required":"Minute erforderlich","invalid time":"ungültige Uhrzeit",customMonthNameToNumberMap:{JAN:"01",FEB:"02","MÄR":"03",APR:"04",MAI:"05",JUN:"06",JUL:"07",AUG:"08",SEP:"09",OKT:"10",NOV:"11",DEZ:"12"},customMonthNumberToName:["JAN","FEB","MÄR","APR","MAI","JUN","JUL","AUG","SEP","OKT","NOV","DEZ"],customDateSeparator:"-",customTimeSeparator:":",customPartialDatePartRegExp:/NK|NA|ND/,customPartialTimePartRegExp:/NK|NA|ND/};af.en={errorIndex:"%s - %s (index %d)%s%s",error:"%s - %s%s%s",required:" required",mustBeEmpty:" must be empty",mustBeUnchecked:" must be unchecked",mustBeUnselected:" must not be selected",mustBeUnmarked:" must not be marked","true":"checked","false":"unchecked",calculatedIndex:"%s - %s (index %d) expected: %s",calculated:"%s - %s expected: %s",enteredIndex:"%s - %s (index %d) entered: %s",entered:"%s - %s entered: %s",noSelectionLabel:"[none]","date is empty":"date is empty","wrong date format":"wrong date format","year required":"year required","month not regognized":"month not regognized","month required":"month required","day required":"day required","invalid date":"invalid date","time is empty":"time is empty","wrong time format":"wrong time format","hour required":"hour required","minute required":"minute required","invalid time":"invalid time",customMonthNameToNumberMap:{JAN:"01",FEB:"02",MAR:"03",APR:"04",MAY:"05",JUN:"06",JUL:"07",AUG:"08",SEP:"09",OCT:"10",NOV:"11",DEC:"12"},customMonthNumberToName:["JAN","FEB","MAR","APR","MAY","JUN","JUL","AUG","SEP","OCT","NOV","DEC"],customDateSeparator:"-",customTimeSeparator:":",customPartialDatePartRegExp:/NK|NA|ND/,customPartialTimePartRegExp:/NK|NA|ND/};function E(aM){if(aM===null||aM===undefined||typeof aM!=="object"){return aM}if(aM instanceof Array){var aK=[];for(var aL=0;aL<aM.length;++aL){aK[aL]=E(aM[aL])}return aK}if(aM instanceof JSJoda.LocalDate){return JSJoda.LocalDate.from(aM)}if(aM instanceof JSJoda.LocalTime){return JSJoda.LocalTime.from(aM)}if(aM instanceof JSJoda.LocalDateTime){return JSJoda.LocalDateTime.from(aM)}if(aM instanceof JSJoda.ZonedDateTime){return JSJoda.ZonedDateTime.from(aM)}var aN={};for(var aL in aM){aN[aL]=E(aM[aL])}return aN}function al(){var aK=0;for(var aL in at){aK++}return aK}function L(aL,aK){if(aL instanceof Array){aK=aL[1];aL=aL[0]}else{if(aL!==null&&typeof aL==="object"){aK=aL.index;aL=aL.name}}return au(aL,aK,false)}function au(aN,aK,aM){if(aN in at){var aL=at[aN];if(aL instanceof Array){if(aK==null){if(aM){return aL}}else{if(aK in aL){return aL[aK]}}}else{return aL}}return null}function ah(){if(FIELD_CALCULATION_DEBUG_LEVEL>=1){console.log("process variables")}for(var aN in at){var aL=at[aN];if(aL instanceof Array){for(var aK=0;aK<aL.length;aK++){if(aK in aL){var aM=aL[aK];K(aM,{})}}}else{var aM=aL;K(aM,{})}}}function d(aO,aL){var aQ="";for(var aP in at){var aM=at[aP];if(aM instanceof Array){for(var aK=0;aK<aM.length;aK++){if(aK in aM){var aN=aM[aK];if((!aO||aO!=aP)||(aL==null||aN.index!=aL)){aN.processed=false;if(FIELD_CALCULATION_DEBUG_LEVEL>=3){console.log("variable "+aC(aN)+" invalidated")}}else{if(FIELD_CALCULATION_DEBUG_LEVEL>=1){aQ=", ecluding "+aC(aN);if(FIELD_CALCULATION_DEBUG_LEVEL>=3){console.log("variable "+aC(aN)+" NOT invalidated")}}}}}}else{var aN=aM;if(!aO||aO!=aP){aN.processed=false;if(FIELD_CALCULATION_DEBUG_LEVEL>=3){console.log("variable "+aC(aN)+" invalidated")}}else{if(FIELD_CALCULATION_DEBUG_LEVEL>=1){aQ=",  ecluding "+aC(aN);if(FIELD_CALCULATION_DEBUG_LEVEL>=3){console.log("variable "+aC(aN)+" NOT invalidated")}}}}}if(FIELD_CALCULATION_DEBUG_LEVEL>=1){console.log("variables invalidated"+aQ)}}function ar(){if(FIELD_CALCULATION_DEBUG_LEVEL>=1){console.log("update and print outputs")}var aO;if(j!=null&&j.length>0){aO=[]}else{aO=null}for(var aN in at){var aL=at[aN];if(aL instanceof Array){for(var aK=0;aK<aL.length;aK++){if(aK in aL){var aM=aL[aK];aG(aM,null);s(aM);if(aO!=null&&(INPUT_FIELD_DELTA_SUMMARY_MAX==null||aO.length<INPUT_FIELD_DELTA_SUMMARY_MAX)){n(aO,aM)}}}}else{var aM=aL;aG(aM,null);s(aM);if(aO!=null&&(INPUT_FIELD_DELTA_SUMMARY_MAX==null||aO.length<INPUT_FIELD_DELTA_SUMMARY_MAX)){n(aO,aM)}}}if(aO!=null){if(FIELD_CALCULATION_DEBUG_LEVEL>=1){console.log("display delta errors: "+aO.length)}setErrorMessageTexts(j,aO);if(aO.length>0){showErrorMessage(j)}else{hideErrorMessage(j)}}return aO}function n(aM,aK){if(aK.processed&&((aK.delta&&(aK.output!=null&&aK.output.length>0))||(aK.valueErrorMessage!=null&&aK.valueErrorMessage.length>0)||(aK.outputErrorMessage!=null&&aK.outputErrorMessage.length>0))){var aL={ecrfFieldId:aK.value.ecrfFieldId,inquiryId:aK.value.inquiryId,tagId:aK.value.tagId,series:aK.value.series,index:aK.value.index,output:null};if(aK.valueErrorMessage!=null&&aK.valueErrorMessage.length>0){aL.output=aK.valueErrorMessage}else{if(aK.outputErrorMessage!=null&&aK.outputErrorMessage.length>0){aL.output=aK.outputErrorMessage}else{if(aK.output!=null&&aK.output.length>0){aL.output=aK.output}}}aM.push(aL)}}function w(aL,aK){d(aL,aK);ah();ar()}function s(aL){if(aL&&aL.outputId!=null&&aL.outputId.length>0){var aK=_getElement(aL.outputId);if(aK!=null){aK.removeClass("ctsms-inputfield-output-valueerror ctsms-inputfield-output-outputerror ctsms-inputfield-output-delta ctsms-inputfield-output-nodelta ctsms-inputfield-output");if(aL.valueErrorMessage!=null&&aL.valueErrorMessage.length>0){aK.html(aL.valueErrorMessage);aK.addClass("ctsms-inputfield-output-valueerror")}else{if(aL.outputErrorMessage!=null&&aL.outputErrorMessage.length>0){aK.html(aL.outputErrorMessage);if(!aK.hasClass("ctsms-inputfield-output-disabled")){aK.addClass("ctsms-inputfield-output-outputerror")}}else{if(aL.output!=null&&aL.output.length>0){aK.html(aL.output);if(aL.value.jsValueExpression!=null&&aL.value.jsValueExpression.length>0){if(!aK.hasClass("ctsms-inputfield-output-disabled")){if(aL.delta){aK.addClass("ctsms-inputfield-output-delta")}else{aK.addClass("ctsms-inputfield-output-nodelta")}}}else{aK.addClass("ctsms-inputfield-output")}}else{aK.html("")}}}}}}function K(aM,aK){if(aM){if(aM.processed){return aM.value}if(FIELD_CALCULATION_DEBUG_LEVEL>=3){console.log("processing variable value "+aC(aM))}aM.valueErrorMessage=null;var aL=R(aM,aM.value.jsValueExpression,"value expression",aK,true);if(aL!=null){aM.oldValue=E(aM.value);aM.valueErrorMessage=aL.errorMessage;ab(aM.value,aL.returnValue)}aM.processed=true;aM.delta=!r(aM);S("variable value updated ",aM);return aM.value}return null}function aG(aM,aK){if(aM){if(FIELD_CALCULATION_DEBUG_LEVEL>=3){console.log("processing variable output "+aC(aM))}aM.outputErrorMessage=null;var aL=R(aM,aM.value.jsOutputExpression,"output expression",aK,false);if(aL!=null){aM.oldOutput=aM.output;aM.outputErrorMessage=aL.errorMessage;aM.output=aL.returnValue}}}function R(aR,aS,a3,a1,aM){var aT;var aZ;var a2=aR.value.jsVariableName;if(aS!=null&&aS.length>0&&aS.indexOf("{")>0){if(FIELD_CALCULATION_DEBUG_LEVEL>=3){console.log("evaluating "+aC(aR)+" "+a3+" ...")}if(a1!=null&&(a2 in a1)){aT=a3+": circular dependency for variable "+a2+" detected";aZ=null}else{if(a1!=null){a1[a2]=true}var aO=aS.substring(0,aS.indexOf("{")).replace(/\s+/gm,"");if(f.test(aO)){var aK=f.exec(aO);var a0=aK[1].split(",");var aX=aR.mask;var aQ=aR.value.index;var aL;var aP;var aV=true;var aN=0;var aW;var aU;for(aW=0;aW<a0.length;aW++){if(a0[aW]!=null&&a0[aW].length>0){aP=au(a0[aW],null,true);if(aP==null){aT=a3+" "+a2+": unknown argument variable "+a0[aW];if(aQ!=null){aT+="["+aQ+"]"}aZ=null;aV=false;break}else{if(aP instanceof Array){if(aP[0]!=null&&aR.value.section==aP[0].value.section){aP=aP[aQ];if(aP==null){aT=a3+" "+a2+": missing argument variable index "+a0[aW];if(aQ!=null){aT+="["+aQ+"]"}aZ=null;aV=false;break}else{aL=K(aP,a1?a1:{})}}else{aL=[];aN=aP.length;for(aU=0;aU<aN;aU++){if(aU in aP){aL.push(K(aP[aU],a1?a1:{}))}}}}else{aL=K(aP,a1?a1:{})}}if((!aP||(aP.valueErrorMessage!=null&&aP.valueErrorMessage.length>0))){aT=aP.valueErrorMessage;aZ=null;aV=false;break}else{if(aL instanceof Array){aX[a0[aW]]=[];aN=aL.length;for(aU=0;aU<aN;aU++){if(aU in aL){aX[a0[aW]].push(c(aL[aU]))}}}else{aX[a0[aW]]=c(aL)}}}}if(aV){aa(aX,aR);aZ=null;try{aZ=(new Function("with(this) {\nreturn ("+aS+")("+a0.join(",")+");\n}")).call(aX);aT=null}catch(aY){if(_testPropertyExists(aY,"msg")){aT=aY.msg}else{aT=a3+" "+a2+": "+aY.toString()}}}}else{aT=a3+": value expression declaration for variable "+a2+" invalid";aZ=null}}if(FIELD_CALCULATION_DEBUG_LEVEL>=3){console.log("evaluating "+aC(aR)+" "+a3+" completed: "+(aT?aT:"no error"))}return{errorMessage:aT,returnValue:aZ}}else{if(aM){aR.oldValue=E(aR.value);aR.value=E(aR.enteredValue);if(FIELD_CALCULATION_DEBUG_LEVEL>=3){console.log("entered value of "+aC(aR)+" copied")}return null}else{return null}}}function aa(aL,aO){var aK=c(aO.value);aL["$value"]=aK;var aP=c(aO.enteredValue);aL["$enteredValue"]=aP;aL["$oldValue"]=c(aO.oldValue);aL["$output"]=aO.output;aL["$delta"]=aO.delta;aL["$oldOutput"]=aO.oldOutput;aL["$created"]=(aO.value.id!=null);aL["$disabled"]=aO.value.disabled;if(aO.value.series){aL["$index"]=aO.value.index}aL["$selectionSetValues"]=aO.value.selectionSetValues;aL["$proband"]=o.proband;aL["$trial"]=o.trial;aL["$probandAddresses"]=o.probandAddresses;aL["$listEntry"]=o.probandListEntry;aL["$visitSchedule"]=o.visitScheduleItems;aL["$probandGroups"]=o.probandGroups;aL["$activeUser"]=o.activeUser;aL["$locale"]=o.locale;aL["$section"]=aO.value.section;aL["$category"]=aO.value.category;aL["$inputFieldName"]=aO.value.inputFieldName;aL["$probandGroup"]=aO.value.probandGroupToken;aL["$visit"]=aO.value.visitToken;aL.getEnteredValue=ac;var aN=function(aV,aW,aU){if(!(aV instanceof Array)){aV=[aV]}var aS=[];if(typeof aW==="undefined"){aW=", "}if(typeof aU==="undefined"){aU="name"}for(var aT=0;aT<aV.length;aT++){aS.push((aO.value.selectionSetValues[aV[aT]])[aU])}return aS.join(aW)};aL.printSelectionSetValues=aN;var aM=function(aV,aS,aW){if(aV==null||aV===undefined){}else{if(typeof aV==="string"){return aV}else{if(typeof aV==="boolean"){return af[o.locale][aV]}else{if(typeof aV==="number"){if(isNaN(aV)){}else{if(typeof aS==="undefined"){if(parseInt(aV)===aV){aS="%d"}else{aS="%f"}}return q(sprintf(aS,aV))}}else{if(aV instanceof Array){if(aV.length<=0||(aV.length==1&&aV[0]=="")){return af[o.locale].noSelectionLabel}return aN(aV,aS,aW)}else{if(aV instanceof JSJoda.LocalDate){if("date"==aS){return N(aV,aW)}else{return aV.format(JSJoda.DateTimeFormatter.ofPattern(aS!=null?aS:INPUT_DATE_PATTERN))}}else{if(aV instanceof JSJoda.LocalTime){if("time"==aS){return J(aV,aW)}else{return aV.format(JSJoda.DateTimeFormatter.ofPattern(aS!=null?aS:INPUT_TIME_PATTERN))}}else{if(aV instanceof JSJoda.LocalDateTime){if("date"==aS){return N(aV,aW)}else{if("time"==aS){return J(aV,aW)}else{return aV.format(JSJoda.DateTimeFormatter.ofPattern(aS!=null?aS:INPUT_DATETIME_PATTERN))}}}else{if(aV instanceof JSJoda.ZonedDateTime){var aU;var aT=INPUT_DATETIME_PATTERN;if(aO.value.userTimeZone){aU=aV.withZoneSameInstant(JSJoda.ZoneId.of(INPUT_TIMEZONE_ID));aT+=" (VV)"}else{aU=aV}if("date"==aS){return N(aU,aW)}else{if("time"==aS){return J(aU,aW)}else{return aU.format(JSJoda.DateTimeFormatter.ofPattern(aS!=null?aS:aT))}}}else{if(typeof aV==="object"&&"ids" in aV){if(aV.ids.length<=0){return af[o.locale].noSelectionLabel}return aN(aV.ids,aS,aW)}else{}}}}}}}}}}return""};aL.printValue=aM;aL.printCalculated=function(aS,aU){var aT=aM(aK,aS,aU);if(aO.value.series){return sprintf(af[o.locale].calculatedIndex,aO.value.section,aO.value.inputFieldName,aO.value.index,aT)}else{return sprintf(af[o.locale].calculated,aO.value.section,aO.value.inputFieldName,aT)}};aL.printEntered=function(aS,aU){var aT=aM(aP,aS,aU);if(aO.value.series){return sprintf(af[o.locale].enteredIndex,aO.value.section,aO.value.inputFieldName,aO.value.index,aT)}else{return sprintf(af[o.locale].entered,aO.value.section,aO.value.inputFieldName,aT)}};aL.findSelectionSetValueIds=function(aU){var aS=[];if(_testFunction(aU)){for(var aT in aO.value.selectionSetValues){if(aU(aO.value.selectionSetValues[aT])){aS.push(aT)}}}return aS};aL.findTagValues=function(aU){var aT=[];if(_testFunction(aU)){for(var aS in o.tagValues){if(aU(o.tagValues[aS])){aT.push(c(o.tagValues[aS]))}}}return aT};var aQ=function(aU,aS,aT){if(aT){aT=""}else{aT=": "}if(aS){aU=af[o.locale][aU]}if(aO.value.series){throw {msg:sprintf(af[o.locale].errorIndex,aO.value.section,aO.value.inputFieldName,aO.value.index,aT,aU)}}else{throw {msg:sprintf(af[o.locale].error,aO.value.section,aO.value.inputFieldName,aT,aU)}}};aL.throwErrorLocalized=function(aT,aS){return aQ(aT,true,aS)};aL.throwError=aQ;var aR=function(){if(aP==null||aP===undefined){aQ("required",true,true)}else{if(typeof aP==="string"){if(aP.length<=0){aQ("required",true,true)}}else{if(typeof aP==="boolean"){}else{if(typeof aP==="number"){}else{if(aP instanceof Array){if(aP.length<=0||(aP.length==1&&aP[0]=="")){aQ("required",true,true)}}else{if(aP instanceof JSJoda.LocalDate){}else{if(aP instanceof JSJoda.LocalTime){}else{if(aP instanceof JSJoda.LocalDateTime){}else{if(aP instanceof JSJoda.ZonedDateTime){}else{if(typeof aP==="object"&&"ids" in aP){if(aP.ids.length<=0){aQ("required",true,true)}}else{}}}}}}}}}}};aL.errorIfEmpty=aR;aL.errorIfUnSet=function(){aR();if(typeof aP==="boolean"){if(!aP){aQ("required",true,true)}}};aL.errorIfSet=function(){if(aP==null||aP===undefined){}else{if(typeof aP==="string"){if(aP.length>0){aQ("mustBeEmpty",true,true)}}else{if(typeof aP==="boolean"){if(aP){aQ("mustBeUnchecked",true,true)}}else{if(typeof aP==="number"){aQ("mustBeEmpty",true,true)}else{if(aP instanceof Array){if(aP.length>0&&!(aP.length==1&&aP[0]=="")){aQ("mustBeUnselected",true,true)}}else{if(aP instanceof JSJoda.LocalDate){aQ("mustBeEmpty",true,true)}else{if(aP instanceof JSJoda.LocalTime){aQ("mustBeEmpty",true,true)}else{if(aP instanceof JSJoda.LocalDateTime){aQ("mustBeEmpty",true,true)}else{if(aP instanceof JSJoda.ZonedDateTime){aQ("mustBeEmpty",true,true)}else{if(typeof aP==="object"&&"ids" in aP){if(aP.ids.length>0){aQ("mustBeUnmarked",true,true)}}else{aQ("mustBeEmpty",true,true)}}}}}}}}}}}}function l(aK){aK.sprintf=sprintf;aK.vsprintf=vsprintf;aK.quoteJs=ak;aK.getInputFieldSelectionSetValue=aB;aK.containsName=X;aK.containsValue=ax;aK.getSeriesValues=a;aK.empty=Z;aK.getLocalizedMessage=y;aK.parseDate=aE;aK.parseDateTime=aI;aK.parseTime=t;aK.formatDecimal=q;aK.parseDateCustom=P;aK.parseTimeCustom=D;aK.selectionSetValueIdsEqual=aJ;aK.setVariable=e;aK.setOutput=am;aK.openInventory=openInventory;aK.openStaff=openStaff;aK.openCourse=openCourse;aK.openTrial=openTrial;aK.openProband=openProband;aK.openInputField=openInputField;aK.openUser=openUser;aK.openMassMail=openMassMail;aK.JSJoda=JSJoda;aK.INPUT_DATE_PATTERN=INPUT_DATE_PATTERN;aK.INPUT_TIME_PATTERN=INPUT_TIME_PATTERN;aK.INPUT_DATETIME_PATTERN=INPUT_DATETIME_PATTERN;aK.INPUT_JSON_DATETIME_PATTERN=INPUT_JSON_DATETIME_PATTERN;aK.INPUT_DECIMAL_SEPARATOR=INPUT_DECIMAL_SEPARATOR;aK.INPUT_TIMEZONE_ID=INPUT_TIMEZONE_ID;aK.SYSTEM_TIMEZONE_ID=SYSTEM_TIMEZONE_ID;aK.JSON=JSON;aK.jQuery=jQuery;aK.RestApi=RestApi;if(ENABLE_GEOLOCATION_SERVICES&&window.LocationDistance){aK.LocationDistance=window.LocationDistance}if(window.console){aK.console=window.console}else{aK.console=null}}function Z(aK){if(aK==null||aK===undefined){return true}else{if(typeof aK==="string"){return aK.length<=0}else{if(typeof aK==="boolean"){return !aK}else{if(typeof aK==="number"){return false}else{if(aK instanceof Array){return(aK.length<=0||(aK.length==1&&aK[0]==""))}else{if(entered instanceof JSJoda.LocalDate){return false}else{if(entered instanceof JSJoda.LocalTime){return false}else{if(entered instanceof JSJoda.LocalDateTime){return false}else{if(entered instanceof JSJoda.ZonedDateTime){return false}else{if(typeof aK==="object"&&"ids" in aK){return aK.ids.length<=0}else{return false}}}}}}}}}}}function ak(aK){return(aK+"").replace(/[\\"']/g,"\\$&").replace(/\u0000/g,"\\0")}function aB(aL,aO){if(aL instanceof Array){aL=aL[0]}else{if(aL!==null&&typeof aL==="object"){aL=aL.name}}var aN=au(aL,null,true);if(aN){if(aN instanceof Array){aN=aN[0]}if(aN){var aK=aN.value.inputFieldSelectionSetValues;if(aK){for(var aM=0;aM<aK.length;aM++){if(aK[aM].id==aO){return aK[aM]}}}}}return{}}function X(aK,aO,aR){if(aO!=null&&aO.length>0){if(aK instanceof Array){aK=aK[0]}else{if(aK!==null&&typeof aK==="object"){aK=aK.name}}var aQ=au(aK,null,true);if(aQ){if(aQ instanceof Array){aQ=aQ[0]}if(aQ){var aM=aQ.value.inputFieldSelectionSetValues;if(aM){var aN={};var aL;for(aL=0;aL<aM.length;aL++){aN[aM[aL].id]=aM[aL]}for(aL=0;aL<aO.length;aL++){var aP=aN[aO[aL]];if(aP!=null&&aP.name==aR){return true}}}}}}return false}function ax(aL,aP,aK){if(aP!=null&&aP.length>0){if(aL instanceof Array){aL=aL[0]}else{if(aL!==null&&typeof aL==="object"){aL=aL.name}}var aR=au(aL,null,true);if(aR){if(aR instanceof Array){aR=aR[0]}if(aR){var aN=aR.value.inputFieldSelectionSetValues;if(aN){var aO={};var aM;for(aM=0;aM<aN.length;aM++){aO[aN[aM].id]=aN[aM]}for(aM=0;aM<aP.length;aM++){var aQ=aO[aP[aM]];if(aQ!=null&&aQ.value==aK){return true}}}}}}return false}function a(aM){if(aM instanceof Array){aM=aM[0]}else{if(aM!==null&&typeof aM==="object"){aM=aM.name}}var aN=au(aM,null,true);var aK=[];if(aN){if(aN instanceof Array){for(var aL=0;aL<aN.length;aL++){if(aL in aN){aK.push(c(aN[aL].value))}}}}return aK}function aE(aK,aL){if(aK==null||aK.length==0){return null}try{return JSJoda.LocalDate.parse(aK,aL!=null?JSJoda.DateTimeFormatter.ofPattern(aL):JSJoda.DateTimeFormatter.ISO_LOCAL_DATE)}catch(aM){return null}}function t(aK,aL){if(aK==null||aK.length==0){return null}try{return JSJoda.LocalTime.parse(aK,aL!=null?JSJoda.DateTimeFormatter.ofPattern(aL):JSJoda.DateTimeFormatter.ISO_LOCAL_TIME)}catch(aM){return null}}function aI(aL,aM,aK){if(aL==null||aL.length==0){return null}try{return JSJoda.ZonedDateTime.of(JSJoda.LocalDateTime.parse(aL,aM!=null?JSJoda.DateTimeFormatter.ofPattern(aM):JSJoda.DateTimeFormatter.ISO_LOCAL_DATE_TIME),JSJoda.ZoneId.of(aK!=null?aK:SYSTEM_TIMEZONE_ID))}catch(aN){return null}}function C(aK){if(aK==null||aK===undefined){return b}else{if(!(aK in af)){return b}}return aK}function y(aL,aK){return af[C(aK)][aL]}function ae(aK){if(aK!=null&&INPUT_DECIMAL_SEPARATOR!=null&&INPUT_DECIMAL_SEPARATOR.length>0){aK=(aK+"").replace(INPUT_DECIMAL_SEPARATOR,".")}return aK}function q(aK){if(aK!=null&&INPUT_DECIMAL_SEPARATOR!=null&&INPUT_DECIMAL_SEPARATOR.length>0){aK=(aK+"").replace(".",INPUT_DECIMAL_SEPARATOR)}return aK}function N(aL,aK){if(aL==null||aL===undefined){}else{if((aL instanceof JSJoda.LocalDate)||(aL instanceof JSJoda.LocalDateTime)||(aL instanceof JSJoda.ZonedDateTime)){var aM=y("customDateSeparator",aK);return zeroFill(aL.dayOfMonth(),2)+aM+y("customMonthNumberToName",aK)[aL.monthValue()-1]+aM+aL.year()}}return""}function J(aL,aK){if(aL==null||aL===undefined){}else{if((aL instanceof JSJoda.LocalTime)||(aL instanceof JSJoda.LocalDateTime)||(aL instanceof JSJoda.ZonedDateTime)){return zeroFill(aL.hour(),2)+y("customTimeSeparator",aK)+zeroFill(aL.minute(),2)}}return""}function P(aW,aT,aO,aV,aX){if(aW==null||aW.length==0){if(_testFunction(aT)){aT("date is empty")}return null}var aK=aW.split(y("customDateSeparator",aX));if(aK==null||aK.length!=3||aK[0].length==0||aK[1].length==0||aK[2].length==0){if(_testFunction(aT)){aT("wrong date format")}return null}var aS=y("customPartialDatePartRegExp",aX);var aQ=(typeof(aO)==typeof(true)?aO:(aO!=null&&aO=="required"));var aY=(typeof(aV)==typeof(true)?aV:(aV!=null&&aV=="required"));if(aS.test(aK[2])){if(aS.test(aK[0])&&aS.test(aK[1])&&!aQ&&!aY){}else{if(_testFunction(aT)){aT("year required")}}return null}var aU=aK[2];var aM;var aN=false;var aP=y("customMonthNameToNumberMap",aX);if(aS.test(aK[1])){if(!aY&&(aV==null||aV.length==0)){aV="01"}else{if(aY){if(_testFunction(aT)){aT("month required")}return null}}aM=aK[1].replace(aS,aV);aN=true}else{if(aK[1] in aP){aM=aP[aK[1]]}else{if(_testFunction(aT)){aT("month not regognized")}return null}}if(!aQ&&(aO==null||aO.length==0)){aO="01"}else{if(aQ&&aS.test(aK[0])){if(_testFunction(aT)){aT("day required")}return null}else{var aZ=JSJoda.LocalDate.of(+aU,+aM,1).lengthOfMonth();if(+aO>aZ){aO=aZ+""}}}var aR;if(aS.test(aK[0])){aR=aK[0].replace(aS,aO)}else{if(aN){if(_testFunction(aT)){aT("month required")}return null}aR=aK[0]}var aL=JSJoda.LocalDate.of(+aU,+aM,+aR);if(aL&&(aL.year()==+aU)&&(+aU>=1900)&&aL.monthValue()==aM&&aL.dayOfMonth()==+aR){return aL}else{if(_testFunction(aT)){aT("invalid date")}return null}}function D(aR,aP,aQ,aS){if(aR==null||aR.length==0){if(_testFunction(aP)){aP("time is empty")}return null}var aK=aR.split(y("customTimeSeparator",aS));if(aK==null||aK.length!=2||aK[0].length==0||aK[1].length==0){if(_testFunction(aP)){aP("wrong time format")}return null}var aO=y("customPartialTimePartRegExp",aS);var aN=(typeof(aN)==typeof(true)?aN:(aN!=null&&aN=="required"));if(aO.test(aK[0])){if(aO.test(aK[1])&&!aN){}else{if(_testFunction(aP)){aP("hour required")}}return null}var aM=aK[0];if(!aN&&(aQ==null||aQ.length==0)){aQ="00"}else{if(aN&&aO.test(aK[1])){if(_testFunction(aP)){aP("minute required")}return null}}var aL=aK[1].replace(aO,aQ);if(+aM>23||+aM<0||+aL>59||+aL<0){if(_testFunction(aP)){aP("invalid time")}return null}else{return JSJoda.LocalTime.of(+aM,+aL)}}function e(aL,aM,aK){var aN=L(aL);if(aN){aN.oldValue=E(aN.value);ab(aN.value,aM);if(FIELD_CALCULATION_DEBUG_LEVEL>=1){S("user code sets variable value ",aN)}if(aK){T(aN)}else{w(aN.value.jsVariableName,aN.value.index)}}}function ac(aL,aK){var aM=L(aL,aK);if(aM){return c(aM.enteredValue)}return null}function am(aL,aK){var aM=L(aL);if(aM){aM.oldOutput=aM.output;aM.output=aK;if(FIELD_CALCULATION_DEBUG_LEVEL>=1){console.log("user code sets variable output "+aC(aM))}s(aM)}}function ab(aL,aM){if(aL!=null){switch(aL.inputFieldType){case"SINGLE_LINE_TEXT":case"MULTI_LINE_TEXT":case"AUTOCOMPLETE":aL.textValue=(aM==null?null:(""+aM));break;case"SKETCH":aL.inkValues=aM.ink;aM=aM.ids;case"SELECT_ONE_DROPDOWN":case"SELECT_ONE_RADIO_H":case"SELECT_ONE_RADIO_V":case"SELECT_MANY_H":case"SELECT_MANY_V":if(!(aM instanceof Array)){aM=(typeof aM==="string")?parseInt(aM):aM;if(isNaN(aM)){aM=[]}else{aM=[aM]}}for(var aK=0;aK<aM.length;aK++){if(typeof aM[aK]==="string"){if(!isNaN(parseInt(aM[aK]))){aM[aK]=aM[aK]}}}aL.selectionValueIds=aM;break;case"CHECKBOX":aL.booleanValue=!!aM;break;case"INTEGER":aL.longValue=(typeof aM==="string")?(isNaN(parseInt(aM))?null:parseInt(aM)):aM;break;case"FLOAT":aL.floatValue=(typeof aM==="string")?(isNaN(parseFloat(aM))?null:parseFloat(aM)):aM;break;case"DATE":if(typeof aM==="string"){aL.dateValue=aE(aM,INPUT_DATE_PATTERN)}else{if(aM instanceof JSJoda.LocalDate){aL.dateValue=aM}else{if(aM instanceof Date){aL.dateValue=JSJoda.LocalDate.from(JSJoda.nativeJs(aM))}else{aL.dateValue=null}}}break;case"TIME":if(typeof aM==="string"){aL.timeValue=t(aM,INPUT_TIME_PATTERN)}else{if(aM instanceof JSJoda.LocalTime){aL.timeValue=aM}else{if(aM instanceof Date){aL.timeValue=JSJoda.LocalTime.from(JSJoda.nativeJs(aM))}else{aL.timeValue=null}}}break;case"TIMESTAMP":if(typeof aM==="string"){aL.timestampValue=aI(aM,INPUT_DATETIME_PATTERN)}else{if(aM instanceof JSJoda.LocalDateTime){aL.timestampValue=JSJoda.ZonedDateTime.of(aM,JSJoda.ZoneId.of(SYSTEM_TIMEZONE_ID))}else{if(aM instanceof JSJoda.ZonedDateTime){aL.timestampValue=aM}else{if(aM instanceof Date){aL.timestampValue=JSJoda.ZonedDateTime.of(JSJoda.LocalDateTime.from(JSJoda.nativeJs(aM)),JSJoda.ZoneId.of(SYSTEM_TIMEZONE_ID))}else{aL.timestampValue=null}}}}break;default:}}}function aC(aK){if(aK!=null){var aL=aK.value;if(aL!=null){var aM="'"+aL.jsVariableName;if(aL.series){aM+="["+aL.index+"]"}aM+="'";return aM}}return""}function S(aL,aK){if(aK!=null){if(FIELD_CALCULATION_DEBUG_LEVEL>=3){console.log(aL+aC(aK)+" = "+JSON.stringify(c(aK.value)))}}}function c(aL){if(aL!=null){switch(aL.inputFieldType){case"SINGLE_LINE_TEXT":case"MULTI_LINE_TEXT":case"AUTOCOMPLETE":return aL.textValue;case"SELECT_ONE_DROPDOWN":case"SELECT_ONE_RADIO_H":case"SELECT_ONE_RADIO_V":case"SELECT_MANY_H":case"SELECT_MANY_V":return aL.selectionValueIds;case"CHECKBOX":return aL.booleanValue;case"INTEGER":return aL.longValue;case"FLOAT":return aL.floatValue;case"DATE":return aL.dateValue;case"TIME":return aL.timeValue;case"TIMESTAMP":return aL.timestampValue;case"SKETCH":var aK={};aK.ink=aL.inkValues;aK.ids=aL.selectionValueIds;return aK;default:}}return null}function r(aK){if(aK!=null){var aL=aK.value;var aM=aK.enteredValue;if(aL!=null&&aM!=null){switch(aL.inputFieldType){case"SINGLE_LINE_TEXT":case"MULTI_LINE_TEXT":case"AUTOCOMPLETE":return aL.textValue===aM.textValue||((aL.textValue==null||aL.textValue.length==0)&&(aM.textValue==null||aM.textValue.length==0));case"SELECT_ONE_DROPDOWN":case"SELECT_ONE_RADIO_H":case"SELECT_ONE_RADIO_V":case"SELECT_MANY_H":case"SELECT_MANY_V":return aJ(aL.selectionValueIds,aM.selectionValueIds);case"CHECKBOX":return aL.booleanValue==aM.booleanValue;case"INTEGER":return aL.longValue==aM.longValue;case"FLOAT":return Math.abs(aL.floatValue-aM.floatValue)<=floatEpsilon;case"DATE":return A(aL.dateValue,aM.dateValue);case"TIME":return A(aL.timeValue,aM.timeValue);case"TIMESTAMP":return A(aL.timestampValue,aM.timestampValue);case"SKETCH":return aL.inkValues==aM.inkValues&&aJ(aL.selectionValueIds,aM.selectionValueIds);default:}}}return null}function A(aL,aK){if(aL!=null&&aK!=null){return aL.equals(aK)}else{if(aL==null&&aK!=null){return false}else{if(aL!=null&&aK==null){return false}else{return true}}}}function aJ(aO,aM){var aQ={};var aL=0;if(aO!=null){for(var aN=0;aN<aO.length;aN++){aQ[aO[aN]]=true;aL++}}var aP={};var aK=0;if(aM!=null){for(var aN=0;aN<aM.length;aN++){aP[aM[aN]]=true;aK++}}if(aL!=aK){return false}for(var aR in aQ){if(!(aR in aP)){return false}}return true}function ao(aM,aK,aL){if(_testFlag(aL,AJAX_OPERATION_SUCCESS)){if(FIELD_CALCULATION_DEBUG_LEVEL>=1){console.log("############### INITIALIZE SYMBOL TABLE ###############")}O();if(_testPropertyExists(aL,AJAX_FIELD_DELTA_ERROR_MESSAGE_ID)){j=aL[AJAX_FIELD_DELTA_ERROR_MESSAGE_ID]}if(j!=null&&j.length>0){hideErrorMessage(j)}aw(aL);az(aL);ah();return ar()}else{if(FIELD_CALCULATION_DEBUG_LEVEL>=1){console.log("############### SERVER-SIDE ERROR, SKIP ###############")}return null}}function O(){for(var aM in at){var aL=at[aM];if(aL instanceof Array){for(var aK=0;aK<aL.length;aK++){if(aK in aL){aL[aK].series=null}}}}at={};o={};j=null;z=false;if(FIELD_CALCULATION_DEBUG_LEVEL>=1){console.log("symbol table cleared")}}function aH(aK){if(FIELD_CALCULATION_DECODE_BASE64){aK=decodeBase64(aK)}return JSON.parse(aK)}function aw(aK){if(_testPropertyExists(aK,AJAX_INPUT_FIELD_PROBAND_BASE64)){o.proband=aH(aK[AJAX_INPUT_FIELD_PROBAND_BASE64])}if(_testPropertyExists(aK,AJAX_INPUT_FIELD_TRIAL_BASE64)){o.trial=aH(aK[AJAX_INPUT_FIELD_TRIAL_BASE64])}if(_testPropertyExists(aK,AJAX_INPUT_FIELD_PROBAND_ADDRESSES_BASE64)){o.probandAddresses=aH(aK[AJAX_INPUT_FIELD_PROBAND_ADDRESSES_BASE64])}if(_testPropertyExists(aK,AJAX_INPUT_FIELD_PROBAND_LIST_ENTRY_TAG_VALUES_BASE64)){var aM=aH(aK[AJAX_INPUT_FIELD_PROBAND_LIST_ENTRY_TAG_VALUES_BASE64]);o.tagValues={};if(aM!=null){for(var aL=0;aL<aM.length;aL++){Y(aM[aL]);o.tagValues[aM[aL].position]=aM[aL]}}}if(_testPropertyExists(aK,AJAX_INPUT_FIELD_PROBAND_LIST_ENTRY_BASE64)){o.probandListEntry=aH(aK[AJAX_INPUT_FIELD_PROBAND_LIST_ENTRY_BASE64])}if(_testPropertyExists(aK,AJAX_INPUT_FIELD_VISIT_SCHEDULE_ITEMS_BASE64)){o.visitScheduleItems=aH(aK[AJAX_INPUT_FIELD_VISIT_SCHEDULE_ITEMS_BASE64])}if(_testPropertyExists(aK,AJAX_INPUT_FIELD_PROBAND_GROUPS_BASE64)){o.probandGroups=aH(aK[AJAX_INPUT_FIELD_PROBAND_GROUPS_BASE64])}if(_testPropertyExists(aK,AJAX_INPUT_FIELD_ACTIVE_USER_BASE64)){o.activeUser=aH(aK[AJAX_INPUT_FIELD_ACTIVE_USER_BASE64])}o.locale=null;if(_testPropertyExists(aK,AJAX_INPUT_FIELD_ACTIVE_USER_BASE64)){o.activeUser=aH(aK[AJAX_INPUT_FIELD_ACTIVE_USER_BASE64]);if(o.activeUser!=null){o.locale=o.activeUser.locale}}if(_testPropertyExists(aK,AJAX_INPUT_FIELD_LOCALE)){o.locale=aK[AJAX_INPUT_FIELD_LOCALE]}o.locale=C(o.locale)}function Y(aL){if(aL.inkValues!=null){aL.inkValues=p(aL.inkValues)}if(aL.inputFieldSelectionSetValues!=null){aL.selectionSetValues={};for(var aK=0;aK<aL.inputFieldSelectionSetValues.length;aK++){if(aL.inputFieldSelectionSetValues[aK].inkRegions!=null){aL.inputFieldSelectionSetValues[aK].inkRegions=p(aL.inputFieldSelectionSetValues[aK].inkRegions)}aL.selectionSetValues[aL.inputFieldSelectionSetValues[aK].id]=aL.inputFieldSelectionSetValues[aK]}}if(typeof aL.dateValue==="string"){if(aL.dateValue==null||aL.dateValue.length==0){aL.dateValue=null}else{try{aL.dateValue=JSJoda.LocalDateTime.parse(aL.dateValue,JSJoda.DateTimeFormatter.ofPattern(INPUT_JSON_DATETIME_PATTERN)).toLocalDate()}catch(aM){aL.dateValue=null}}}else{if(aL.dateValue instanceof Date){aL.dateValue=JSJoda.LocalDate.from(JSJoda.nativeJs(aL.dateValue))}}if(typeof aL.timeValue==="string"){if(aL.timeValue==null||aL.timeValue.length==0){aL.timeValue=null}else{try{aL.timeValue=JSJoda.LocalDateTime.parse(aL.timeValue,JSJoda.DateTimeFormatter.ofPattern(INPUT_JSON_DATETIME_PATTERN)).toLocalTime()}catch(aM){aL.timeValue=null}}}else{if(aL.timeValue instanceof Date){aL.timeValue=JSJoda.LocalTime.from(JSJoda.nativeJs(aL.timeValue))}}if(typeof aL.timestampValue==="string"){if(aL.timestampValue==null||aL.timestampValue.length==0){aL.timestampValue=null}else{try{aL.timestampValue=JSJoda.ZonedDateTime.of(JSJoda.LocalDateTime.parse(aL.timestampValue,JSJoda.DateTimeFormatter.ofPattern(INPUT_JSON_DATETIME_PATTERN)),JSJoda.ZoneId.of(SYSTEM_TIMEZONE_ID))}catch(aM){aL.timestampValue=null}}}else{if(aL.timestampValue instanceof Date){aL.timestampValue=JSJoda.ZonedDateTime.of(JSJoda.LocalDateTime.from(JSJoda.nativeJs(aL.timestampValue)),JSJoda.ZoneId.of(SYSTEM_TIMEZONE_ID))}}if(typeof aL.userTimeZone==="string"){aL.userTimeZone=!!aL.userTimeZone}if(typeof aL.floatValue==="string"){aL.floatValue=parseFloat(aL.floatValue)}if(typeof aL.longValue==="string"){aL.longValue=parseInt(aL.longValue)}if(typeof aL.booleanValue==="string"){aL.booleanValue=!!aL.booleanValue}if(!aL.series){aL.series=false;aL.index=null}if(aL.category!=null){aL.section=aL.category}}function az(aS){if(_testPropertyExists(aS,AJAX_INPUT_FIELD_VARIABLE_VALUES_BASE64)){var aU=aH(aS[AJAX_INPUT_FIELD_VARIABLE_VALUES_BASE64]);var aM="merged "+aU.length+" variable values";var aT=0;var aO=0;var aP=al();var aR;var aQ=new CommentStripper();for(var aN=0;aN<aU.length;aN++){var aV=aU[aN];if(aV.jsVariableName!=null&&aV.jsVariableName.length>0){Y(aV);var aL={};aV.jsValueExpression=aQ.strip(aV.jsValueExpression);aV.jsOutputExpression=aQ.strip(aV.jsOutputExpression);if(_testPropertyExists(aV,"inquiryId")){aL.outputId=INPUT_FIELD_OUTPUT_ID_PREFIX+aV.inquiryId}else{if(_testPropertyExists(aV,"tagId")){aL.outputId=INPUT_FIELD_OUTPUT_ID_PREFIX+aV.tagId}else{if(_testPropertyExists(aV,"ecrfFieldId")){aL.outputId=INPUT_FIELD_OUTPUT_ID_PREFIX+aV.ecrfFieldId;if(aV.series){aL.outputId+=INPUT_FIELD_OUTPUT_ID_INDEX_SEPARATOR+aV.index}}}}if(_testPropertyExists(aV,"inquiryId")){aL.widgetVarName=INPUT_FIELD_WIDGET_VAR_PREFIX+aV.inquiryId}else{if(_testPropertyExists(aV,"tagId")){aL.widgetVarName=INPUT_FIELD_WIDGET_VAR_PREFIX+aV.tagId}else{if(_testPropertyExists(aV,"ecrfFieldId")){aL.widgetVarName=INPUT_FIELD_WIDGET_VAR_PREFIX+aV.ecrfFieldId;if(aV.series){aL.widgetVarName+=INPUT_FIELD_WIDGET_VAR_INDEX_SEPARATOR+aV.index}}}}aL.processed=false;aL.valueErrorMessage=null;aL.outputErrorMessage=null;aL.output=null;aL.oldOutput=null;aL.delta=false;aL.value=aV;aL.oldValue=E(aV);var aW={};for(var aK in this){aW[aK]=undefined}l(aW);aL.mask=aW;if(aV.series){if(aV.jsVariableName in at){if(aV.index in at[aV.jsVariableName]){if(FIELD_CALCULATION_DEBUG_LEVEL>=2){console.log("variable "+aC(aL)+" updated")}aO++}else{if(FIELD_CALCULATION_DEBUG_LEVEL>=2){console.log("variable "+aC(aL)+" added")}aT++}}else{at[aV.jsVariableName]=[];if(FIELD_CALCULATION_DEBUG_LEVEL>=2){console.log("variable "+aC(aL)+" added")}aT++}aL.series=at[aV.jsVariableName];at[aV.jsVariableName][aV.index]=aL}else{if(aV.jsVariableName in at){if(FIELD_CALCULATION_DEBUG_LEVEL>=2){console.log("variable "+aC(aL)+" updated")}aO++}else{if(FIELD_CALCULATION_DEBUG_LEVEL>=2){console.log("variable "+aC(aL)+" added")}aT++}at[aV.jsVariableName]=aL}aL.enteredValue=E(aV)}}if(FIELD_CALCULATION_DEBUG_LEVEL>=1){aR=al();aM+=": "+aT+" added, "+aO+" updated";console.log(aM);console.log("symbol table size: "+aP+" before, "+aR+" after")}}}function aF(aM,aK,aL){if(FIELD_CALCULATION_DEBUG_LEVEL>=1){console.log("############### UPDATE SYMBOL TABLE ###################")}d();az(aL);ah();return ar()}function aD(aK){if(!z){ai(aK.inquiry.jsVariableName,aK.index,getSingleLineTextVal(aK.inquiry.id))}}function x(aK){if(!z){ai(aK.inquiry.jsVariableName,aK.index,getMultiLineTextVal(aK.inquiry.id))}}function V(aK){if(!z){ai(aK.inquiry.jsVariableName,aK.index,getSelectOneDropdownVal(aK.inquiry.id))}}function k(aK){if(!z){ai(aK.inquiry.jsVariableName,aK.index,getSelectOneRadioVal(aK.inquiry.id))}}function F(aK){if(!z){ai(aK.inquiry.jsVariableName,aK.index,getSelectManyVal(aK.inquiry.id))}}function i(aK){if(!z){ai(aK.inquiry.jsVariableName,aK.index,getAutocompleteVal(aK.inquiry.id))}}function u(aK){if(!z){ai(aK.inquiry.jsVariableName,aK.index,getCheckboxVal(aK.inquiry.id))}}function ad(aK){if(!z){ai(aK.inquiry.jsVariableName,aK.index,getSpinnerVal(aK.inquiry.id))}}function M(aK){if(!z){ai(aK.inquiry.jsVariableName,aK.index,getDecimalVal(aK.inquiry.id))}}function aA(aK){if(!z){ai(aK.inquiry.jsVariableName,aK.index,getDatePickerVal(aK.inquiry.id))}}function g(aK){if(!z){ai(aK.inquiry.jsVariableName,aK.index,getTimePickerVal(aK.inquiry.id))}}function av(aN){if(!z){var aO=aN.inquiry.jsVariableName;var aK=aN.index;var aM=getDateTimePickerVal(aN.inquiry.id);if(aM!=null){aM=JSJoda.LocalDateTime.from(JSJoda.nativeJs(aM));var aL=au(aO,aK,false);if(aL!=null&&aL.value.userTimeZone){aM=JSJoda.ZonedDateTime.of(aM,JSJoda.ZoneId.of(INPUT_TIMEZONE_ID)).withZoneSameInstant(JSJoda.ZoneId.of(SYSTEM_TIMEZONE_ID))}else{aM=JSJoda.ZonedDateTime.of(aM,JSJoda.ZoneId.of(SYSTEM_TIMEZONE_ID))}}ai(aO,aK,aM)}}function ay(aR,aQ,aP){if(!z){var aM=au(aR,aQ,false);var aN=Sketch.unpackValue(Sketch.getSketchValue(aP));var aK=[];if(aM){var aS=aM.value.inputFieldSelectionSetValues;var aL={};if(aS){for(var aO=0;aO<aS.length;aO++){aL[aS[aO].strokesId]=aS[aO]}}if(!(aN.ids instanceof Array)){aN.ids=[aN.ids]}for(var aO=0;aO<aN.ids.length;aO++){if(aN.ids[aO]&&aL[aN.ids[aO]]){aK[aO]=aL[aN.ids[aO]].id}}}ai(aR,aQ,{ink:aN.ink,ids:aK})}}function ai(aN,aK,aM){var aL=au(aN,aK,false);if(aL){ab(aL.enteredValue,aM);if(FIELD_CALCULATION_DEBUG_LEVEL>=1){console.log("onchange "+aC(aL))}w()}}function m(aM,aK){var aL=au(aM,aK,false);if(aL){aL.enteredValue=E(aL.value);aL.delta=false;if(FIELD_CALCULATION_DEBUG_LEVEL>=1){console.log("apply calculated value "+aC(aL))}w(aM,aK);return c(aL.value)}return null}function ag(aK){z=true;setSingleLineTextVal(aK.inquiry.id,m(aK.inquiry.jsVariableName,aK.index));z=false}function U(aK){z=true;setMultiLineTextVal(aK.inquiry.id,m(aK.inquiry.jsVariableName,aK.index));z=false}function aq(aK){z=true;setSelectOneDropdownVal(aK.inquiry.id,m(aK.inquiry.jsVariableName,aK.index));z=false}function v(aK){z=true;setSelectOneRadioVal(aK.inquiry.id,m(aK.inquiry.jsVariableName,aK.index));z=false}function aj(aK){z=true;setSelectManyVal(aK.inquiry.id,m(aK.inquiry.jsVariableName,aK.index));z=false}function I(aK){z=true;setAutocompleteVal(aK.inquiry.id,m(aK.inquiry.jsVariableName,aK.index));z=false}function Q(aK){z=true;setCheckboxVal(aK.inquiry.id,m(aK.inquiry.jsVariableName,aK.index));z=false}function W(aK){z=true;setSpinnerVal(aK.inquiry.id,m(aK.inquiry.jsVariableName,aK.index));z=false}function ap(aK){z=true;setDecimalVal(aK.inquiry.id,q(m(aK.inquiry.jsVariableName,aK.index)));z=false}function G(aK){z=true;var aL=m(aK.inquiry.jsVariableName,aK.index);setDatePickerVal(aK.inquiry.id,aL!=null?JSJoda.convert(aL).toDate():null);z=false}function an(aK){z=true;var aL=m(aK.inquiry.jsVariableName,aK.index);setTimePickerVal(aK.inquiry.id,aL!=null?JSJoda.convert(JSJoda.LocalDateTime.of(1970,1,1,aL.hour(),aL.minute())).toDate():null);z=false}function H(aM){z=true;var aN=m(aM.inquiry.jsVariableName,aM.index);var aL=null;if(aN!=null){var aK=au(aM.inquiry.jsVariableName,aM.index,false);if(aK!=null&&aK.value.userTimeZone){aL=aN.withZoneSameInstant(JSJoda.ZoneId.of(INPUT_TIMEZONE_ID))}else{aL=aN}aL=JSJoda.convert(aL.toLocalDateTime()).toDate()}setDateTimePickerVal(aM.inquiry.id,aL);z=false}function B(aL,aK){z=true;var aM=m(aL.inquiry.jsVariableName,aL.index);Sketch.setSketchValue(aK,aM.ink);z=false}function T(aL){if(aL!=null){var aK={};aK.inquiry={};aK.inquiry.id=aL.value.inquiryId;aK.inquiry.jsVariableName=aL.value.jsVariableName;aK.index=aL.value.index;switch(aL.value.inputFieldType){case"SINGLE_LINE_TEXT":ag(aK);break;case"MULTI_LINE_TEXT":U(aK);break;case"AUTOCOMPLETE":I(aK);break;case"SELECT_ONE_DROPDOWN":aq(aK);break;case"SELECT_ONE_RADIO_H":case"SELECT_ONE_RADIO_V":v(aK);break;case"SELECT_MANY_H":case"SELECT_MANY_V":aj(aK);break;case"CHECKBOX":Q(aK);break;case"INTEGER":W(aK);break;case"FLOAT":ap(aK);break;case"DATE":G(aK);break;case"TIME":an(aK);break;case"TIMESTAMP":H(aK);break;case"SKETCH":B(aK,window[aL.widgetVarName]);break;default:}}}function p(aK){var aL,aM="";for(aL=0;aL<aK.length;aL++){aM+="%"+("0"+aK[aL].toString(16)).slice(-2)}return decodeURIComponent(aM)}h.handleInitInputFieldVariables=ao;h.resetInputFieldVariables=O;h.handleUpdateInputFieldVariables=aF;h.singleLineTextOnChange=aD;h.multiLineTextOnChange=x;h.selectOneDropdownOnChange=V;h.selectOneRadioOnChange=k;h.selectManyOnChange=F;h.autoCompleteOnChange=i;h.checkBoxOnChange=u;h.integerOnChange=ad;h.floatOnChange=M;h.dateOnChange=aA;h.timestampOnChange=av;h.timeOnChange=g;h.sketchOnChange=ay;h.singleLineTextApplyCalculatedValue=ag;h.multiLineTextApplyCalculatedValue=U;h.selectOneDropdownApplyCalculatedValue=aq;h.selectOneRadioApplyCalculatedValue=v;h.selectManyApplyCalculatedValue=aj;h.autoCompleteApplyCalculatedValue=I;h.checkBoxApplyCalculatedValue=Q;h.integerApplyCalculatedValue=W;h.floatApplyCalculatedValue=ap;h.dateApplyCalculatedValue=G;h.timestampApplyCalculatedValue=H;h.timeApplyCalculatedValue=an;h.sketchApplyCalculatedValue=B;l(h);if(FIELD_CALCULATION_DEBUG_LEVEL>=1){console.log("field calculation utilities loaded")}})(window.FieldCalculation);