var idRegexp=/^(\d+)_(\d+_)?([a-z_]+)$/;function initPrimeUI(a){a.fieldsPerPage=5;a.fieldsPerRow=1;a.init=true;a.checkForm=null;a.cs=new CommentStripper();$("#messages").puimessages();$("#inquiries").puidatagrid({header:a.inquiriesGridHeader,paginator:{rows:a.fieldsPerPage,page:+a.inquiryPage},lazy:true,columns:1,datasource:function(d,c,b){_saveEnteredData(a,this,d,c,b)},content:function(e){a.inquiryStatusVar.i+=1;a.inquiryStatusVar.first=(a.inquiryStatusVar.i==1);a.inquiryStatusVar.last=(a.inquiryStatusVar.i==a.inquiryStatusVar.rows);if(e._posted){a.inquiryStatusVar.posted+=1}a.inquiryStatusVar.toPost=a.inquiryStatusVar.i-a.inquiryStatusVar.posted;var b=a.cs.strip(e.inquiry.jsValueExpression);e.hasJsVar=e.inquiry.jsVariableName!=null&&e.inquiry.jsVariableName.length>0;e.hasJsValueExpression=b!=null&&b.length>0;if(a.inquiryStatusVar.first){a.inquiryStatusVar.category=e.inquiry.category}var d=[];var c=_addInquiryField(a,e);if(c!=null){d.push(c)}if(a.inquiryStatusVar.last){d.push(_createInquiryCategory(a))}return d.length>0?d:null},initContent:function(b){while(a.inquiryStatusVar.fieldsToInit.length>0){var c=a.inquiryStatusVar.fieldsToInit.shift();_initInquiryField(a,c.value,c.content)}}});$("#incomplete_dlg").puidialog({draggable:false,resizable:false,width:"auto",modal:true,closeOnEscape:false,closable:false,minimizable:false,maximizable:false,buttons:[{text:a.yesBtnLabel,icon:"fa-check",click:function(){$("#incomplete_dlg").puidialog("hide");a.checkForm=false;$("#form").submit()}},{text:a.noBtnLabel,icon:"fa-close",click:function(){$("#incomplete_dlg").puidialog("hide")}}]});$("#form").submit(function(){return _sanitizeForm(a)});_updateInquiryPbar(a);$("#inquiryform_blank_btn").puibutton({icon:"fa-file-pdf-o",click:function(b){showWaitDlg();window.open(a.uriBase+"/inquiry/pdf?blank=1","_blank");hideWaitDlg()}});$("#prev_btn").puibutton({icon:"fa-angle-left"});$("#done_btn").puibutton({icon:"fa-angle-double-right",iconPos:"right"});$("#save_next_btn").puibutton({icon:"fa-angle-right",iconPos:"right",click:function(b){a.checkForm=true}})}function _addInquiryField(a,c){var b=null;if(a.inquiryStatusVar.category!=c.inquiry.category){b=_createInquiryCategory(a);a.inquiryStatusVar.category=c.inquiry.category;a.inquiryStatusVar.categoryFields=[]}var d={content:_createInquiryField(a,c),value:c};a.inquiryStatusVar.categoryFields.push(d);return b}function _createInquiryCategory(c){var d=$("<div></div>").puipanel({title:c.inquiryStatusVar.category});var b=$('<div class="ui-datagrid-content ui-datagrid-col-'+c.fieldsPerRow+'"></div>');d.append(b);for(var a=0;a<c.inquiryStatusVar.categoryFields.length;a++){b.append(c.inquiryStatusVar.categoryFields[a].content);c.inquiryStatusVar.fieldsToInit.push(c.inquiryStatusVar.categoryFields[a])}return d}function _createInquiryField(c,j){var h=$('<div class="ctsms-form-entry"/>');var a=$('<div class="ui-grid"/>');var m=$("<fieldset/>").append($("<legend/>").append(document.createTextNode(j.inquiry.position+". "+j.inquiry.field.name))).append(a).puifieldset({toggleable:true});h.append(m);var l=$('<div class="ui-grid-row"/>').appendTo(a);l.append($('<div class="ui-grid-col-4" style="margin-top:4px;"/>').append($('<label class="ctsms-align-top'+(j.inquiry.optional?"":" ctsms-required")+'"/>').append(document.createTextNode(j.inquiry.field.title))));var b=$('<div class="ui-grid-col-8"/>');l.append(b);switch(j.inquiry.field.fieldType.type){case"SINGLE_LINE_TEXT":b.append(_createSingleLineText(c,j));break;case"MULTI_LINE_TEXT":b.append(_createMultiLineText(c,j));break;case"AUTOCOMPLETE":b.append(_createAutocomplete(c,j));break;case"DATE":b.append(_createDatePicker(c,j));break;case"TIME":b.append(_createTimePicker(c,j));break;case"TIMESTAMP":b.append(_createDateTimePicker(c,j));break;case"CHECKBOX":b.append(_createCheckbox(c,j));break;case"SELECT_ONE_DROPDOWN":b.append(_createSelectOneDropdown(c,j));break;case"SELECT_ONE_RADIO_H":b.append(_createSelectOneRadio(c,j,false));break;case"SELECT_ONE_RADIO_V":b.append(_createSelectOneRadio(c,j,true));break;case"SELECT_MANY_H":b.append(_createSelectMany(c,j,false));break;case"SELECT_MANY_V":b.append(_createSelectMany(c,j,true));break;case"SKETCH":b.append(_createSketchpad(c,j));break;case"INTEGER":b.append(_createSpinner(c,j));break;case"FLOAT":b.append(_createDecimal(c,j));break;default:break}var i=j.inquiry.id+"_message";a.append($('<div class="ui-grid-col-12"><div id="'+i+'" /></div>'));if(j.hasJsVar){var f=$('<div id="'+_getOutputId(j)+'"'+(j.inquiry.disabled?' class="ctsms-inputfield-output-disabled"':"")+">");a.append($('<div class="ui-grid-col-12 ctsms-inputfield-output-row"/>').append(f))}if(j.inquiry.field.comment!=null&&j.inquiry.field.comment.length>0){var e=$('<pre class="ui-widget ctsms-multilinetext">');e.append(document.createTextNode(j.inquiry.field.comment));a.append($('<div class="ui-grid-col-12 ctsms-inputfield-comment-row"/>').append(e))}if(j.inquiry.comment!=null&&j.inquiry.comment.length>0){var g=$('<pre class="ui-widget ctsms-multilinetext">');g.append(document.createTextNode(j.inquiry.comment));a.append($('<div class="ui-grid-col-12 ctsms-inputfield-comment-row"/>').append(g))}if(j.hasJsValueExpression&&!j.inquiry.disabled){var d=j.inquiry.id+"_apply_button";var k=$('<button type="button" id="'+d+'">'+c.applyCalculatedValueBtnLabel+"</button>").puibutton({icon:"fa-reply"});a.append($('<div class="ui-grid-col-12" style="text-align:right;"/>').append(k))}return h}function _initInquiryField(c,e,d){var f=e.inquiry.id+"_apply_button";switch(e.inquiry.field.fieldType.type){case"SINGLE_LINE_TEXT":_initSingleLineText(c,e,d);$("#"+f).on("click",function(g){FieldCalculation.singleLineTextApplyCalculatedValue(e)});break;case"MULTI_LINE_TEXT":_initMultiLineText(c,e,d);$("#"+f).on("click",function(g){FieldCalculation.multiLineTextApplyCalculatedValue(e)});break;case"AUTOCOMPLETE":_initAutocomplete(c,e,d);$("#"+f).on("click",function(g){FieldCalculation.autoCompleteApplyCalculatedValue(e)});break;case"DATE":_initDatePicker(c,e,d);$("#"+f).on("click",function(g){FieldCalculation.dateApplyCalculatedValue(e)});break;case"TIME":_initTimePicker(c,e,d);$("#"+f).on("click",function(g){FieldCalculation.timeApplyCalculatedValue(e)});break;case"TIMESTAMP":_initDateTimePicker(c,e,d);$("#"+f).on("click",function(g){FieldCalculation.timestampApplyCalculatedValue(e)});break;case"CHECKBOX":_initCheckbox(c,e,d);$("#"+f).on("click",function(g){FieldCalculation.checkBoxApplyCalculatedValue(e)});break;case"SELECT_ONE_DROPDOWN":_initSelectOneDropdown(c,e,d);$("#"+f).on("click",function(g){FieldCalculation.selectOneDropdownApplyCalculatedValue(e)});break;case"SELECT_ONE_RADIO_H":case"SELECT_ONE_RADIO_V":_initSelectOneRadio(c,e,d);$("#"+f).on("click",function(g){FieldCalculation.selectOneRadioApplyCalculatedValue(e)});break;case"SELECT_MANY_H":case"SELECT_MANY_V":_initSelectMany(c,e,d);$("#"+f).on("click",function(g){FieldCalculation.selectManyApplyCalculatedValue(e)});break;case"SKETCH":var a=_initSketchpad(c,e,d);window[INPUT_FIELD_WIDGET_VAR_PREFIX+e.inquiry.id]=a;$("#"+f).on("click",function(g){FieldCalculation.sketchApplyCalculatedValue(e,a)});break;case"INTEGER":_initSpinner(c,e,d);$("#"+f).on("click",function(g){FieldCalculation.integerApplyCalculatedValue(e)});break;case"FLOAT":_initDecimal(c,e,d);$("#"+f).on("click",function(g){FieldCalculation.floatApplyCalculatedValue(e)});break;default:break}var b=e.inquiry.id+"_message";$("#"+b).puimessages()}function _createDatePicker(b,f){var e="date_"+f.inquiry.id;var g=f.inquiry.id+"_date_picker";var a=f.inquiry.id+"_date_picker_hidden";var c=$('<input type="hidden" name="'+e+'" id="'+a+'" value="'+(f.dateValue!=null?f.dateValue:"")+'"'+(!f.inquiry.disabled?" disabled":"")+"/>");var d=$('<input type="text" class="ctsms-control-date" name="'+e+'" id="'+g+'" value="'+(f.dateValue!=null?f.dateValue:"")+'"/>').puidatepicker({});return[c,d]}function _initDatePicker(a,c,b){var d=c.inquiry.id+"_date_picker";if(c.inquiry.disabled){$("#"+d).puidatepicker("disable")}else{if(c.hasJsVar){$("#"+d).on("change",function(e){FieldCalculation.dateOnChange(c)}).on("keyup",function(e){FieldCalculation.dateOnChange(c)})}}$("#"+d).puitooltip({my:"left bottom",at:"left top",content:_getTooltipText(a,c)})}function setDatePickerVal(c,a){var b=$("#"+c+"_date_picker");_setPickerDate(b,a)}function getDatePickerVal(b){var a=$("#"+b+"_date_picker");return a.puidatepicker("getDate")}function _setPickerDate(b,a){if(a!=null){if($.type(a)==="string"){a=dateIsoToUi(a)}b.puidatepicker("setDate",a)}else{b.puidatepicker("setDate",null)}}function _createTimePicker(c,e){var a="time_"+e.inquiry.id;var f=e.inquiry.id+"_time_picker";var b=e.inquiry.id+"_time_picker_hidden";var g=$('<input type="hidden" name="'+a+'" id="'+b+'" value="'+(e.timeValue!=null?e.timeValue:"")+'"'+(!e.inquiry.disabled?" disabled":"")+"/>");var d=$('<input type="text" class="ctsms-control-time" name="'+a+'" id="'+f+'" value="'+(e.timeValue!=null?e.timeValue:"")+'"/>').puitimepicker({});return[g,d]}function _initTimePicker(a,c,b){var d=c.inquiry.id+"_time_picker";if(c.inquiry.disabled){$("#"+d).puitimepicker("disable")}else{if(c.hasJsVar){$("#"+d).on("change",function(e){FieldCalculation.timeOnChange(c)}).on("keyup",function(e){FieldCalculation.timeOnChange(c)})}}$("#"+d).puitooltip({my:"left bottom",at:"left top",content:_getTooltipText(a,c)})}function setTimePickerVal(b,c){var a=$("#"+b+"_time_picker");_setPickerTime(a,c)}function getTimePickerVal(b){var a=$("#"+b+"_time_picker");return a.puitimepicker("getTime")}function _setPickerTime(a,b){if(b!=null){if($.type(b)==="string"&&b.length>0){b=timeIsoToUi(b)}a.puitimepicker("setTime",b)}else{a.puitimepicker("setTime",null)}}function _createDateTimePicker(c,j){var e="timestampdate_"+j.inquiry.id;var i=j.inquiry.id+"_timestampdate_picker";var b=j.inquiry.id+"_timestampdate_picker_hidden";var h=$('<input type="hidden" name="'+e+'" id="'+b+'" value="'+(j.timestampdateValue!=null?j.timestampdateValue:"")+'"'+(!j.inquiry.disabled?" disabled":"")+"/>");var k=$('<input type="text" class="ctsms-control-date" name="'+e+'" id="'+i+'" value="'+(j.timestampdateValue!=null?j.timestampdateValue:"")+'"/>').puidatepicker({});var d="timestamptime_"+j.inquiry.id;var l=j.inquiry.id+"_timestamptime_picker";var g=j.inquiry.id+"_timestamptime_picker_hidden";var f=$('<input type="hidden" name="'+d+'" id="'+g+'" value="'+(j.timestamptimeValue!=null?j.timestamptimeValue:"")+'"'+(!j.inquiry.disabled?" disabled":"")+"/>");var a=$('<input type="text" class="ctsms-control-time" name="'+d+'" id="'+l+'" value="'+(j.timestamptimeValue!=null?j.timestamptimeValue:"")+'"/>').puitimepicker({});return[h,k,f,a]}function _initDateTimePicker(a,c,b){var e=c.inquiry.id+"_timestampdate_picker";if(c.inquiry.disabled){$("#"+e).puidatepicker("disable")}else{if(c.hasJsVar){$("#"+e).on("change",function(f){FieldCalculation.timestampOnChange(c)}).on("keyup",function(f){FieldCalculation.timestampOnChange(c)})}}$("#"+e).puitooltip({my:"left bottom",at:"left top",content:_getTooltipText(a,c)});var d=c.inquiry.id+"_timestamptime_picker";if(c.inquiry.disabled){$("#"+d).puitimepicker("disable")}else{if(c.hasJsVar){$("#"+d).on("change",function(f){FieldCalculation.timestampOnChange(c)}).on("keyup",function(f){FieldCalculation.timestampOnChange(c)})}}}function setDateTimePickerVal(b,c){var a=$("#"+b+"_timestampdate_picker");_setPickerDate(a,c);a=$("#"+b+"_timestamptime_picker");_setPickerTime(a,c)}function getDateTimePickerVal(c){var b=$("#"+c+"_timestampdate_picker");var a=b.puidatepicker("getDate");if(a!=null){b=$("#"+c+"_timestamptime_picker");var d=b.puitimepicker("getTime");if(d!=null){return new Date(a.getFullYear(),a.getMonth(),a.getDate(),d.getHours(),d.getMinutes(),0)}}return null}function _createSingleLineText(c,f){var b="text_"+f.inquiry.id;var e=f.inquiry.id+"_single_line_text";var g=f.inquiry.id+"_single_line_text_hidden";var a=$("<input>",{type:"hidden",name:b,id:g,disabled:!f.inquiry.disabled,value:(f.textValue!=null?f.textValue:"")});var d=$("<input>",{type:"text","class":"ctsms-control-larger",name:b,id:e,value:(f.textValue!=null?f.textValue:"")}).puiinputtext();return[a,d]}function _initSingleLineText(a,d,b){var c=d.inquiry.id+"_single_line_text";if(d.inquiry.disabled){$("#"+c).puiinputtext("disable")}else{if(d.hasJsVar){$("#"+c).on("change",function(e){FieldCalculation.singleLineTextOnChange(d)}).on("keyup",function(e){FieldCalculation.singleLineTextOnChange(d)})}}$("#"+c).puitooltip({my:"left bottom",at:"left top",content:_getTooltipText(a,d)})}function setSingleLineTextVal(b,c){var a=$("#"+b+"_single_line_text");a.val(c)}function getSingleLineTextVal(b){var a=$("#"+b+"_single_line_text");return a.val()}function _createMultiLineText(b,e){var g="text_"+e.inquiry.id;var f=e.inquiry.id+"_multi_line_text";var d=e.inquiry.id+"_multi_line_text_hidden";var a=$("<input>",{type:"hidden",name:g,id:d,disabled:!e.inquiry.disabled,value:(e.textValue!=null?e.textValue:"")});var c=$('<textarea class="ctsms-textarea" name="'+g+'" id="'+f+'"/>');c.append(document.createTextNode((e.textValue!=null?e.textValue:"")));return[a,c]}function _initMultiLineText(a,c,b){var d=c.inquiry.id+"_multi_line_text";$("#"+d).puiinputtextarea({});if(c.inquiry.disabled){$("#"+d).puiinputtextarea("disable")}else{if(c.hasJsVar){$("#"+d).on("change",function(e){FieldCalculation.multiLineTextOnChange(c)}).on("keyup",function(e){FieldCalculation.multiLineTextOnChange(c)})}}$("#"+d).puitooltip({my:"left bottom",at:"left top",content:_getTooltipText(a,c)})}function setMultiLineTextVal(b,c){var a=$("#"+b+"_multi_line_text");a.val(c)}function getMultiLineTextVal(b){var a=$("#"+b+"_multi_line_text");return a.val()}function _createCheckbox(a,e){var g="boolean_"+e.inquiry.id;var h=e.inquiry.id+"_checkbox";var i=e.inquiry.id+"_checkbox_hidden";var b=$('<input type="hidden" name="'+g+'" id="'+i+'" value="'+(e.booleanValue?"true":"false")+'"'+(!e.inquiry.disabled?" disabled":"")+"/>");var d=e.inquiry.id+"_checkbox_default_hidden";var f=$('<input type="hidden" name="'+g+'" id="'+d+'" value="false"'+(e.inquiry.disabled?" disabled":"")+"/>");var c=$('<input type="checkbox" name="'+g+'" id="'+h+'" value="true"'+(e.booleanValue?' checked="checked"':"")+"/>");return[b,f,c]}function _initCheckbox(a,c,b){var d=c.inquiry.id+"_checkbox";$("#"+d).puicheckbox();if(c.inquiry.disabled){$("#"+d).puicheckbox("disable")}else{if(c.hasJsVar){$("#"+d).on("change",function(e){FieldCalculation.checkBoxOnChange(c)})}}}function setCheckboxVal(c,b){var a=$("#"+c+"_checkbox");if(b){a.puicheckbox("check")}else{a.puicheckbox("uncheck")}}function getCheckboxVal(b){var a=$("#"+b+"_checkbox");return a.puicheckbox("isChecked")}function _createSelectOneDropdown(b,m){var e="selection_"+m.inquiry.id;var a=m.inquiry.id+"_select_one_dropdown";var d=_getSelectionSetValuesIdMap(m.selectionValues);var f=m.inquiry.id+"_select_one_dropdown_hidden";var c=$('<input type="hidden" name="'+e+'" id="'+f+'" value=""'+(!m.inquiry.disabled?" disabled":"")+"/>");var o=[c];var l=$('<select name="'+e+'" id="'+a+'"/>');var j=$('<option value=""/>');j.append(document.createTextNode(b.noSelectionLabel));l.append(j);if(m.inquiry.field.selectionSetValues!=null){for(var h=0;h<m.inquiry.field.selectionSetValues.length;h++){var k=m.inquiry.field.selectionSetValues[h];if(k.id in d){var n=m.inquiry.id+"_"+k.id+"_select_one_dropdown_hidden";var g=$('<input type="hidden" name="'+e+'" id="'+n+'" value="'+k.id+'"'+(!m.inquiry.disabled?" disabled":"")+"/>");o.push(g)}j=$('<option value="'+k.id+'"'+(k.id in d?' selected="selected"':"")+"/>");j.append(document.createTextNode(k.name));l.append(j)}}o.push(l);return o}function _initSelectOneDropdown(a,d,c){var b=d.inquiry.id+"_select_one_dropdown";$("#"+b).puidropdown({styleClass:"ctsms-control",change:(!d.inquiry.disabled&&d.hasJsVar?function(e){FieldCalculation.selectOneDropdownOnChange(d)}:null)});if(d.inquiry.disabled){$("#"+b).puidropdown("disable")}$("#"+b).parent().parent().find(".ui-inputtext").puitooltip({my:"left bottom",at:"left top",content:_getTooltipText(a,d)})}function setSelectOneDropdownVal(d,b){var c=$("#"+d+"_select_one_dropdown");if(b!=null&&b.length>0){for(var a=0;a<b.length;a++){c.puidropdown("selectValue",b[a])}}else{c.puidropdown("selectValue","")}}function getSelectOneDropdownVal(b){var a=$("#"+b+"_select_one_dropdown");var c=a.puidropdown("getSelectedValue");if(c!=null&&c.length>0){return[c]}return[]}function _getSelectionSetValuesIdMap(d){var a={};if(d!=null){for(var c=0;c<d.length;c++){var b=d[c];a[b.id]=b}}return a}function _createSelectOneRadio(e,p,b){var s="selection_"+p.inquiry.id;var j=_getSelectionSetValuesIdMap(p.selectionValues);var g=p.inquiry.id+"_select_one_radio_hidden";var f=$('<input type="hidden" name="'+s+'" id="'+g+'" value=""/>');var n=[f];var c=p.inquiry.id+"_select_one_radio";var a=$('<div id="'+c+'" class="ui-grid"/>');var h=null;if(p.inquiry.field.selectionSetValues!=null){for(var q=0;q<p.inquiry.field.selectionSetValues.length;q++){var l=p.inquiry.field.selectionSetValues[q];var m=p.inquiry.id+"_"+l.id+"_select_one_radio";if(l.id in j){var r=p.inquiry.id+"_"+l.id+"_select_one_radio_hidden";var d=$('<input type="hidden" name="'+s+'" id="'+r+'" value="'+l.id+'"'+(!p.inquiry.disabled?" disabled":"")+"/>");n.push(d)}var o=$('<input type="radio" name="'+s+'" id="'+m+'" value="'+l.id+'"'+(l.id in j?' checked="checked"':"")+"/>");var k=$('<label for="'+m+'" class="ui-widget" />');k.append(document.createTextNode(l.name));if(b||h==null){h=$('<div class="ui-grid-row" style="margin-bottom: 4px;"/>');a.append(h)}$('<div class="ui-grid-col-1"/>').append(o).appendTo(h);if(b){$('<div class="ui-grid-col-11" style="display:table;text-align:left;padding-top: 2px;"/>').append(k).appendTo(h)}else{$('<div class="ui-grid-col-2" style="display:table;text-align:left;padding-top: 2px;"/>').append(k).appendTo(h)}}}n.push(a);return n}function _initSelectOneRadio(c,e,d){if(e.inquiry.field.selectionSetValues!=null){for(var b=0;b<e.inquiry.field.selectionSetValues.length;b++){var g=e.inquiry.field.selectionSetValues[b];var a=e.inquiry.id+"_"+g.id+"_select_one_radio";$("#"+a).puiradiobutton();if(e.inquiry.disabled){$("#"+a).puiradiobutton("disable")}else{if(e.hasJsVar){$("#"+a).on("change",function(h){FieldCalculation.selectOneRadioOnChange(e)})}}}}var f=e.inquiry.id+"_select_one_radio";$("#"+f).puitooltip({my:"left bottom",at:"left top",content:_getTooltipText(c,e)});$("#"+f).off().on("mouseenter",function(h){$("#"+f).puitooltip("show")}).on("mouseleave",function(h){$("#"+f).puitooltip("hide")})}function setSelectOneRadioVal(c,b){if(b!=null){for(var a=0;a<b.length;a++){$("#"+c+"_"+b[a]+"_select_one_radio").puiradiobutton("check")}}}function getSelectOneRadioVal(c){var b=$('[id^="'+c+'_"] input[type="radio"');var a=[];b.each(function(d,e){if($(this).puiradiobutton("isChecked")){a.push($(this).val())}});return a}function _createSelectMany(c,n,b){var l="selection_"+n.inquiry.id;var g=_getSelectionSetValuesIdMap(n.selectionValues);var p=n.inquiry.id+"_select_many_hidden";var s=$('<input type="hidden" name="'+l+'" id="'+p+'" value=""/>');var k=[s];var q=n.inquiry.id+"_select_many";var a=$('<div id="'+q+'" class="ui-grid"/>');var f=null;if(n.inquiry.field.selectionSetValues!=null){for(var o=0;o<n.inquiry.field.selectionSetValues.length;o++){var j=n.inquiry.field.selectionSetValues[o];var e=n.inquiry.id+"_"+j.id+"_select_many";if(j.id in g){var d=n.inquiry.id+"_"+j.id+"_select_many_hidden";var r=$('<input type="hidden" name="'+l+'" id="'+d+'" value="'+j.id+'"'+(!n.inquiry.disabled?" disabled":"")+"/>");k.push(r)}var m=$('<input type="checkbox" name="'+l+'" id="'+e+'" value="'+j.id+'"'+(j.id in g?' checked="checked"':"")+"/>");var h=$('<label for="'+e+'" class="ui-widget" />');h.append(document.createTextNode(j.name));if(b||f==null){f=$('<div class="ui-grid-row" style="margin-bottom: 4px;"/>');a.append(f)}$('<div class="ui-grid-col-1" />').append(m).appendTo(f);if(b){$('<div class="ui-grid-col-11" style="display:table;text-align:left;padding-top: 2px;"/>').append(h).appendTo(f)}else{$('<div class="ui-grid-col-2" style="display:table;text-align:left;padding-top: 2px;"/>').append(h).appendTo(f)}}}k.push(a);return k}function _initSelectMany(b,d,c){if(d.inquiry.field.selectionSetValues!=null){for(var a=0;a<d.inquiry.field.selectionSetValues.length;a++){var f=d.inquiry.field.selectionSetValues[a];var g=d.inquiry.id+"_"+f.id+"_select_many";$("#"+g).puicheckbox();if(d.inquiry.disabled){$("#"+g).puicheckbox("disable")}else{if(d.hasJsVar){$("#"+g).on("change",function(h){FieldCalculation.selectManyOnChange(d)})}}}}var e=d.inquiry.id+"_select_many";$("#"+e).puitooltip({my:"left bottom",at:"left top",content:_getTooltipText(b,d)});$("#"+e).off().on("mouseenter",function(h){$("#"+e).puitooltip("show")}).on("mouseleave",function(h){$("#"+e).puitooltip("hide")})}function setSelectManyVal(e,d){var a=$('[id^="'+e+'_"] input[type="checkbox"]');var c={};if(d!=null){for(var b=0;b<d.length;b++){c[d[b]]=1}}a.each(function(f,g){if($(this).val() in c){$(this).puicheckbox("check")}else{$(this).puicheckbox("uncheck")}})}function getSelectManyVal(c){var b=$('[id^="'+c+'_"] input[type="checkbox"]');var a=[];b.each(function(d,e){if($(this).puicheckbox("isChecked")){a.push($(this).val())}});return a}function _createAutocomplete(b,g){var c="text_"+g.inquiry.id;var a=g.inquiry.id+"_autocomplete";var f=g.inquiry.id+"_autocomplete_hidden";var e=$("<input>",{type:"hidden",name:c,id:f,disabled:!g.inquiry.disabled,value:(g.textValue!=null?g.textValue:"")});var d=$("<input>",{type:"text","class":"ctsms-control-larger",name:c,id:a,value:(g.textValue!=null?g.textValue:"")});return[e,d]}function _initAutocomplete(c,e,d){var a=e.inquiry.id+"_autocomplete";var b=$.extend(true,{},getFieldValueAutoCompleteConfig(e.inquiry.field));if(!e.inquiry.disabled&&e.hasJsVar){b.select=function(g,f){FieldCalculation.autoCompleteOnChange(e)}}$("#"+a).puiautocomplete(b);if(e.inquiry.disabled){$("#"+a).puiautocomplete("disable")}else{if(e.hasJsVar&&!e.inquiry.field.strict){$("#"+a).on("change",function(f){FieldCalculation.autoCompleteOnChange(e)}).on("keyup",function(f){FieldCalculation.autoCompleteOnChange(e)})}}$("#"+a).puitooltip({my:"left bottom",at:"left top",content:_getTooltipText(c,e)})}function setAutocompleteVal(b,c){var a=$("#"+b+"_autocomplete");a.val(c)}function getAutocompleteVal(b){var a=$("#"+b+"_autocomplete");return a.val()}function _createSketchpadButton(c,a,e){var d=$("<td/>");var b=$('<div id="'+c+'" class="'+a+'"/>');d.append(b);b.puitooltip({my:"left bottom",at:"left top",content:e});d.off().on("mouseenter","#"+c,null,function(f){$("#"+c).puitooltip("show")}).on("mouseleave","#"+c,null,function(f){$("#"+c).puitooltip("hide")});return d}function _createSketchpad(b,h){var e="ink_"+h.inquiry.id;var d=h.inquiry.id+"_sketchpad_input";var j=h.inquiry.id+"_sketchpad";var i=$("<input>",{type:"hidden",name:e,id:d,value:(h.inkValue!=null?h.inkValue:"")});var a="";var c=$('<div class="sketchpad" id="'+j+'" style="width:'+(h.inquiry.field.width==null?"":h.inquiry.field.width)+"px;height:"+(h.inquiry.field.height==null?"":h.inquiry.field.height)+"px;"+a+'"/>');var f=$("<span/>");if(!h.inquiry.disabled){var g=$("<tr/>");g.append(_createSketchpadButton(j+"_regionToggler","sketch-region-toggler-off",b.sketchToggleRegionTooltip));g.append(_createSketchpadButton(j+"_drawEraseMode","sketch-draw-mode",b.sketchDrawModeTooltip));g.append(_createSketchpadButton(j+"_undo","sketch-undo-disabled",b.sketchUndoTooltip));g.append(_createSketchpadButton(j+"_redo","sketch-redo-disabled",b.sketchRedoTooltip));g.append(_createSketchpadButton(j+"_clear","sketch-clear-disabled",b.sketchClearTooltip));g.append($("<td/>").append(document.createTextNode(" ")));g.append($("<td/>").append('<input type="text" id="'+j+'_colorPicker"/>'));g.append(_createSketchpadButton(j+"_penWidth0","sketch-pen-width-0-disabled",b.sketchPenWidth0Tooltip));g.append(_createSketchpadButton(j+"_penWidth1","sketch-pen-width-1-disabled",b.sketchPenWidth1Tooltip));g.append(_createSketchpadButton(j+"_penWidth2","sketch-pen-width-2",b.sketchPenWidth2Tooltip));g.append(_createSketchpadButton(j+"_penWidth3","sketch-pen-width-3-disabled",b.sketchPenWidth3Tooltip));g.append(_createSketchpadButton(j+"_penOpacity0","sketch-pen-opacity-0",b.sketchPenOpacity0Tooltip));g.append(_createSketchpadButton(j+"_penOpacity1","sketch-pen-opacity-1-disabled",b.sketchPenOpacity1Tooltip));g.append(_createSketchpadButton(j+"_penOpacity2","sketch-pen-opacity-2-disabled",b.sketchPenOpacity2Tooltip));var k=$('<table class="sketch-toolbar-table"/>');k.append(g);f.append(k)}f.append(c);return[i,f]}function _initSketchpad(d,f,e){var g=f.inquiry.id+"_sketchpad_input";var a=f.inquiry.id+"_sketchpad";var b=[f.inkValue==null?"":f.inkValue,g,a,f.inquiry.field.width==null?0:f.inquiry.field.width,f.inquiry.field.height==null?0:f.inquiry.field.height,d.ctsmsBaseUri+"inputfieldimage?inputfieldid="+f.inquiry.field.id,!f.inquiry.disabled,f.hasJsVar?'FieldCalculation.sketchOnChange("'+f.inquiry.jsVariableName+'",'+f.index+",this)":null,null];for(var c=0;c<f.inquiry.field.selectionSetValues.length;c++){var h=f.inquiry.field.selectionSetValues[c];b.push(h.inkRegions)}return Sketch.initSketch.apply(this,b)}function _createSpinner(d,f){var a="long_"+f.inquiry.id;var c=f.inquiry.id+"_spinner";var b=f.inquiry.id+"_spinner_hidden";var e=$('<input type="hidden" name="'+a+'" id="'+b+'" value="'+(f.longValue!=null?f.longValue:"")+'"'+(!f.inquiry.disabled?" disabled":"")+"/>");var g=$('<input type="text" class="ctsms-spinner" name="'+a+'" id="'+c+'" value="'+(f.longValue!=null?f.longValue:"")+'"/>');return[e,g]}function _initSpinner(b,d,c){var a=d.inquiry.id+"_spinner";$("#"+a).puispinner({});if(d.inquiry.disabled){$("#"+a).puispinner("disable")}else{if(d.hasJsVar){$("#"+a).on("change",function(e){FieldCalculation.integerOnChange(d)}).on("keyup",function(e){FieldCalculation.integerOnChange(d)})}}$("#"+a).puitooltip({my:"left bottom",at:"left top",content:_getTooltipText(b,d)})}function setSpinnerVal(b,c){var a=$("#"+b+"_spinner");a.val(c)}function getSpinnerVal(b){var a=$("#"+b+"_spinner");return a.val()}function _createDecimal(e,f){var d="float_"+f.inquiry.id;var c=f.inquiry.id+"_decimal";var a=f.inquiry.id+"_decimal_hidden";var g=$('<input type="hidden" name="'+d+'" id="'+a+'" value="'+(f.floatValue!=null?f.floatValue:"")+'"'+(!f.inquiry.disabled?" disabled":"")+"/>");var b=$('<input type="text" class="ctsms-control-float" name="'+d+'" id="'+c+'" value="'+(f.floatValue!=null?f.floatValue:"")+'"/>').puiinputtext({});return[g,b]}function _initDecimal(b,d,c){var a=d.inquiry.id+"_decimal";if(d.inquiry.disabled){$("#"+a).puiinputtext("disable")}else{if(d.hasJsVar){$("#"+a).on("change",function(e){FieldCalculation.floatOnChange(d)}).on("keyup",function(e){FieldCalculation.floatOnChange(d)})}}$("#"+a).puitooltip({my:"left bottom",at:"left top",content:_getTooltipText(b,d)})}function setDecimalVal(b,c){var a=$("#"+b+"_decimal");a.val(c)}function getDecimalVal(b){var a=$("#"+b+"_decimal");return a.val().replace(/,/,".")}function _updateInquiryPbar(a){var b=0;if(a.trial!=null&&a.trial._activeInquiryCount>0){b=Math.round((a.trial._savedInquiryCount/a.trial._activeInquiryCount)*100)}$("#inquiry_pbar").puiprogressbar({labelTemplate:sprintf(a.inquiriesPbarTemplate,+a.trial._savedInquiryCount,+a.trial._activeInquiryCount),value:b})}function _saveEnteredData(c,b,e,d,a){if(!c.init){c.checkForm=false;if(_sanitizeForm(c)){$.ajax({type:"POST",url:c.uriBase+"/inquiry/savepage",data:$("#form").serialize(),context:b,error:function(f,h,g){$.ajaxSettings.error(f,h,g);if(a!=null){a(true)}},success:function(f){c.trial=f;setMessages("warn",null);_loadPage(c,b,e,d,a)}})}}else{_loadPage(c,b,e,d,a)}}function _loadPage(c,b,e,d,a){$.ajax({url:c.uriBase+"/inquiries",data:{rows:d.rows,first:d.first,load_all_js_values:(c.init?1:0)},context:b,success:function(g){c.trial=g.trial;c.inquiryStatusVar={i:0,first:true,last:null,rows:g.rows.length,category:null,categoryFields:[],fieldsToInit:[],posted:0,toPost:0};if(this.options.paginator){this.options.paginator.totalRecords=g.paginator.total_count}e.call(this,g.rows);if(c.apiError!=null){setMessages("warn",c.apiError)}var f={};f[AJAX_OPERATION_SUCCESS]=true;f[AJAX_INPUT_FIELD_VARIABLE_VALUES_BASE64]=g.js_rows_base64;f[AJAX_INPUT_FIELD_PROBAND_BASE64]=c.probandBase64;f[AJAX_INPUT_FIELD_TRIAL_BASE64]=c.trialBase64;f[AJAX_INPUT_FIELD_PROBAND_ADDRESSES_BASE64]=c.probandAddressesBase64;f[AJAX_INPUT_FIELD_LOCALE]=c.lang;if(c.init){FieldCalculation.handleInitInputFieldVariables(null,null,f);c.init=false}else{FieldCalculation.handleUpdateInputFieldVariables(null,null,f)}if(a!=null){a(false)}_updateInquiryPbar(c);hideWaitDlg()}})}function _getInquiryId(a){return a.id.match(idRegexp)[2]}function _getTooltipText(b,d){var a=d.inquiry.field.fieldType.name+" ";if(d.inquiry.field.fieldType.type=="TIMESTAMP"){if(d.inquiry.field.userTimeZone){a+=b.inputTimeLabel}else{a+=b.systemTimeLabel}}if(d.inquiry.optional){a+=b.optionalLabel}else{a+=b.requiredLabel}a+=".";var c=d.inquiry.field.validationErrorMsg;if(c!=null&&c.length>0){a+=" "+c}return a}function _sanitizeForm(a){if(a.checkForm){if(a.trial._savedInquiryCount<a.trial._activeInquiryCount&&(a.trial._postedInquiryCount+(a.saveAllPages?0:a.trial._savedInquiryCount)+a.inquiryStatusVar.toPost)<a.trial._activeInquiryCount){$("#incomplete_dlg").puidialog("show");return false}}showWaitDlg();return true};